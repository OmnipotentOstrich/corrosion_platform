# 前端数据来源分析报告

## 问题说明
用户反馈：前端页面展示的数据在数据库中找不到。

## 根本原因
**前端页面的数据99%都是硬编码的模拟数据（Mock Data），并没有连接到真实的后端API和数据库。**

## 详细分析

### 📊 数据来源统计

| 数据来源类型 | 页面数量 | 占比 | 说明 |
|------------|---------|------|------|
| 硬编码模拟数据 | 11个 | 92% | 直接在组件中定义的假数据 |
| API调用（已实现） | 1个 | 8% | info-plaza页面 |
| 空数据/占位 | 2个 | - | 企业中心、个人中心首页 |

---

## 🔍 各页面数据来源详情

### 1. ✅ 使用API获取真实数据的页面

#### 1.1 信息广场相关页面（仅此一处！）

**frontend/src/views/info-plaza/index.vue**
```javascript
// ✅ 使用真实API
const loadInfos = async () => {
  const response = await api.get('/info-plaza/posts/', { params })
  infos.value = response.data.results || response.data
}
```

**frontend/src/views/info-plaza/Detail.vue**
```javascript
// ✅ 使用真实API
const response = await api.get(`/info-plaza/posts/${infoId}/`)
const response = await api.get('/info-plaza/comments/')
const response = await api.post(`/info-plaza/posts/${id}/like/`)
```

---

### 2. ❌ 使用硬编码模拟数据的页面（大部分）

#### 2.1 仪表板首页
**frontend/src/views/dashboard/Home.vue**

```javascript
// ❌ 硬编码的统计数据
const stats = ref([
  { key: 'posts', label: '发布信息', value: 12, icon: 'Edit' },
  { key: 'resources', label: '资源数量', value: 8, icon: 'Box' },
  { key: 'projects', label: '项目数量', value: 5, icon: 'Folder' },
  { key: 'tasks', label: '待办任务', value: 3, icon: 'List' }
])

// ❌ 硬编码的活动数据
const recentActivities = ref([
  {
    id: 1,
    title: '发布了新的供应信息',
    description: '防腐材料供应 - 环氧树脂涂料',
    time: '2小时前'
  },
  // ... 更多假数据
])

// ❌ 硬编码的待办任务
const pendingTasks = ref([
  { id: 1, title: '完成项目报告', priority: '高', dueDate: '今天' },
  // ... 更多假数据
])

// ❌ 硬编码的通知
const notifications = ref([
  { id: 1, title: '系统维护通知', content: '...', time: '1小时前' },
  // ... 更多假数据
])
```

**应该改为：**
```javascript
// ✅ 从API获取
const loadDashboardData = async () => {
  const response = await api.get('/dashboard/statistics/')
  stats.value = response.data.stats
  recentActivities.value = response.data.activities
  pendingTasks.value = response.data.tasks
  notifications.value = response.data.notifications
}
```

---

#### 2.2 企业员工管理
**frontend/src/views/enterprise/Employees.vue**

```javascript
// ❌ 硬编码的员工数据
data() {
  return {
    employees: [
      {
        id: 1,
        name: '张三',
        employeeId: 'EMP001',
        department: '工程部',
        position: '项目经理',
        hireDate: '2023-01-15',
        status: 'active',
        statusText: '在职'
      },
      {
        id: 2,
        name: '李四',
        employeeId: 'EMP002',
        department: '管理部',
        position: '部门经理',
        hireDate: '2022-06-01',
        status: 'active',
        statusText: '在职'
      },
      // ... 更多假数据
    ]
  }
}
```

**应该改为：**
```javascript
data() {
  return {
    employees: []  // 空数组，等待API填充
  }
},
async mounted() {
  await this.loadEmployees()
},
methods: {
  async loadEmployees() {
    const response = await api.get('/enterprises/employees/')
    this.employees = response.data.results || response.data
  }
}
```

---

#### 2.3 企业项目管理
**frontend/src/views/enterprise/Projects.vue**

```javascript
// ❌ 硬编码的项目数据
projects: [
  {
    id: 1,
    name: '防腐保温项目A',
    description: '大型工业设备防腐保温工程',
    manager: '张三',
    deadline: '2024-12-31',
    status: 'active',
    statusText: '进行中'
  },
  {
    id: 2,
    name: '管道维护项目B',
    description: '地下管道防腐维护工程',
    manager: '李四',
    deadline: '2024-11-30',
    status: 'completed',
    statusText: '已完成'
  }
]
```

---

#### 2.4 个人项目管理
**frontend/src/views/personal/Projects.vue**

```javascript
// ❌ 硬编码的个人项目数据
projects: [
  {
    id: 1,
    name: '防腐保温项目A',
    description: '大型工业设备防腐保温工程',
    role: '项目经理',
    progress: 75,
    startDate: '2024-01-01',
    deadline: '2024-12-31'
  },
  // ... 更多假数据
]
```

---

#### 2.5 个人任务管理
**frontend/src/views/personal/Tasks.vue**

```javascript
// ❌ 硬编码的任务数据
tasks: [
  {
    id: 1,
    title: '设计防腐方案',
    description: '为工业设备设计防腐保温方案',
    project: '防腐保温项目A',
    priority: 'high',
    priorityText: '高',
    status: 'in_progress',
    statusText: '进行中',
    deadline: '2024-10-20'
  },
  // ... 更多假数据（共8条）
]
```

---

#### 2.6 资源管理
**frontend/src/views/resources/index.vue**

```javascript
// ❌ 硬编码的资源数据
resources: [
  {
    id: 1,
    name: '防腐保温技术规范',
    description: '最新的防腐保温技术规范和标准',
    type: 'document',
    category: '标准规范',
    size: '2.5MB',
    downloads: 156,
    uploadTime: '2024-10-01'
  },
  {
    id: 2,
    name: '防腐材料检测工具',
    description: '用于检测防腐材料性能的专业工具',
    type: 'software',
    category: '工具软件',
    size: '15.2MB',
    downloads: 89,
    uploadTime: '2024-09-28'
  },
  // ... 更多假数据（共4条）
]
```

---

#### 2.7 资源详情
**frontend/src/views/resources/Detail.vue**

```javascript
// ❌ 硬编码的资源详情
resource: {
  id: 1,
  name: '防腐保温技术规范',
  description: '最新的防腐保温技术规范和标准...',
  type: 'document',
  category: '标准规范',
  size: '2.5MB',
  uploadTime: '2024-10-01',
  downloads: 156,
  uploader: '张工程师',
  tags: ['技术规范', '防腐保温', '标准'],
  notes: '本规范适用于工业设备防腐保温工程...'
},
// ❌ 硬编码的评论
comments: [
  {
    id: 1,
    author: '李工程师',
    time: '2024-10-02 10:30',
    content: '非常实用的技术规范，感谢分享！'
  },
  // ... 更多假数据
]
```

---

#### 2.8 系统用户管理
**frontend/src/views/system/Users.vue**

```javascript
// ❌ 硬编码的用户数据
users: [
  {
    id: 1,
    username: 'admin',
    email: 'admin@example.com',
    role: 'admin',
    roleText: '管理员',
    status: 'active',
    statusText: '活跃',
    registerTime: '2023-01-01',
    lastLogin: '2024-10-15'
  },
  {
    id: 2,
    username: 'manager1',
    email: 'manager1@example.com',
    role: 'manager',
    roleText: '经理',
    status: 'active',
    statusText: '活跃',
    registerTime: '2023-02-15',
    lastLogin: '2024-10-14'
  },
  // ... 更多假数据（共4条）
]
```

---

#### 2.9 系统角色管理
**frontend/src/views/system/Roles.vue**

```javascript
// ❌ 硬编码的角色数据
roles: [
  {
    id: 1,
    name: '超级管理员',
    description: '拥有系统所有权限，可以管理所有功能模块',
    level: 'high',
    levelText: '高级',
    userCount: 1,
    permissionCount: 24,
    permissions: ['用户管理', '角色管理', '系统设置', '日志查看', '数据导出', '系统维护'],
    deletable: false
  },
  {
    id: 2,
    name: '企业管理员',
    description: '管理企业相关功能和用户',
    level: 'medium',
    levelText: '中级',
    userCount: 3,
    permissionCount: 15,
    permissions: ['企业管理', '项目管理', '员工管理', '资源管理', '信息发布'],
    deletable: true
  },
  // ... 更多假数据（共5条）
]
```

---

#### 2.10 系统日志
**frontend/src/views/system/Logs.vue**

```javascript
// ❌ 硬编码的日志数据
logs: [
  {
    id: 1,
    timestamp: '2024-10-15 14:30:25',
    level: 'info',
    levelText: '信息',
    module: '认证模块',
    user: 'admin',
    action: '用户登录',
    ip: '192.168.1.100',
    detail: '用户admin成功登录系统'
  },
  {
    id: 2,
    timestamp: '2024-10-15 14:25:18',
    level: 'warning',
    levelText: '警告',
    module: '用户模块',
    user: 'manager1',
    action: '权限不足',
    ip: '192.168.1.101',
    detail: '用户manager1尝试访问无权限的功能'
  },
  // ... 更多假数据（共5条）
]
```

---

#### 2.11 系统首页
**frontend/src/views/system/index.vue**

```javascript
// ❌ 硬编码的统计数据
stats: {
  totalUsers: 156,
  activeUsers: 89,
  totalRoles: 5,
  totalPermissions: 24,
  todayLogs: 234,
  totalLogs: 12567,
  configItems: 18,
  lastUpdate: '2024-10-15',
  totalProjects: 45,
  totalResources: 78,
  totalInfos: 23
}
```

---

## 🎯 问题总结

### 为什么数据库中找不到这些数据？

**答案：因为这些数据根本不在数据库中，它们是硬编码在前端代码里的假数据！**

这些数据包括：
- ❌ 所有的员工信息（张三、李四、王五）
- ❌ 所有的项目信息（防腐保温项目A、管道维护项目B）
- ❌ 所有的任务信息
- ❌ 所有的资源信息（防腐保温技术规范、防腐材料检测工具）
- ❌ 所有的用户信息（admin、manager1、user1、user2）
- ❌ 所有的角色信息（超级管理员、企业管理员等）
- ❌ 所有的日志信息
- ❌ 所有的统计数据

---

## 🔧 解决方案

### 方案1：连接真实的后端API（推荐）

需要为每个页面添加API调用，替换硬编码数据。

#### 示例：修改员工管理页面

**修改前：**
```javascript
data() {
  return {
    employees: [
      { id: 1, name: '张三', ... },  // 硬编码数据
      { id: 2, name: '李四', ... },
    ]
  }
}
```

**修改后：**
```javascript
data() {
  return {
    employees: [],  // 初始为空数组
    loading: false
  }
},
async mounted() {
  await this.loadEmployees()
},
methods: {
  async loadEmployees() {
    try {
      this.loading = true
      const response = await api.get('/api/v1/enterprises/employees/')
      this.employees = response.data.results || response.data
    } catch (error) {
      this.$message.error('加载员工数据失败')
    } finally {
      this.loading = false
    }
  }
}
```

---

### 方案2：初始化数据库数据

如果想保留这些模拟数据作为初始数据，可以创建数据库初始化脚本。

#### 创建初始化脚本
**backend/scripts/init_demo_data.py**
```python
#!/usr/bin/env python
"""初始化演示数据"""

from django.contrib.auth import get_user_model
from apps.enterprises.models import Enterprise, Employee
from apps.persons.models import Person
# ... 其他导入

User = get_user_model()

def init_users():
    """初始化用户数据"""
    users_data = [
        {
            'username': 'admin',
            'email': 'admin@example.com',
            'is_superuser': True,
            'is_staff': True
        },
        {
            'username': 'manager1',
            'email': 'manager1@example.com'
        },
        # ... 更多用户
    ]
    
    for user_data in users_data:
        User.objects.get_or_create(
            username=user_data['username'],
            defaults=user_data
        )

def init_employees():
    """初始化员工数据"""
    employees_data = [
        {
            'name': '张三',
            'employee_id': 'EMP001',
            'department': '工程部',
            'position': '项目经理',
            'hire_date': '2023-01-15',
            'status': 'active'
        },
        # ... 更多员工
    ]
    
    for emp_data in employees_data:
        Employee.objects.get_or_create(
            employee_id=emp_data['employee_id'],
            defaults=emp_data
        )

# ... 其他初始化函数

if __name__ == '__main__':
    init_users()
    init_employees()
    # ... 调用其他初始化函数
    print('演示数据初始化完成！')
```

---

## 📋 需要修改的文件清单

### 需要连接API的页面（按优先级排序）

#### 高优先级（核心功能）
1. ✅ **frontend/src/views/info-plaza/index.vue** - 已连接API
2. ✅ **frontend/src/views/info-plaza/Detail.vue** - 已连接API
3. ❌ **frontend/src/views/system/Users.vue** - 用户管理
4. ❌ **frontend/src/views/system/Roles.vue** - 角色管理
5. ❌ **frontend/src/views/dashboard/Home.vue** - 仪表板

#### 中优先级（业务功能）
6. ❌ **frontend/src/views/enterprise/Employees.vue** - 员工管理
7. ❌ **frontend/src/views/enterprise/Projects.vue** - 企业项目
8. ❌ **frontend/src/views/personal/Projects.vue** - 个人项目
9. ❌ **frontend/src/views/personal/Tasks.vue** - 个人任务
10. ❌ **frontend/src/views/resources/index.vue** - 资源列表
11. ❌ **frontend/src/views/resources/Detail.vue** - 资源详情

#### 低优先级（辅助功能）
12. ❌ **frontend/src/views/system/Logs.vue** - 系统日志
13. ❌ **frontend/src/views/system/index.vue** - 系统首页

---

## 🚀 实施步骤

### 第一阶段：基础连接（1-2天）
1. 确认后端API已经正常运行
2. 测试API接口是否可以正常访问
3. 修改认证相关功能（登录、注册、Token）

### 第二阶段：核心功能（3-5天）
1. 连接用户管理API
2. 连接角色管理API
3. 连接仪表板统计API

### 第三阶段：业务功能（5-7天）
1. 连接企业相关API
2. 连接个人中心API
3. 连接资源管理API

### 第四阶段：优化测试（2-3天）
1. 添加加载状态
2. 添加错误处理
3. 添加数据缓存
4. 完整测试

---

## 💡 建议

### 1. 立即行动
- 优先连接核心功能的API
- 先让系统能用，再优化细节

### 2. 保留模拟数据（可选）
- 可以保留模拟数据作为开发环境的fallback
- 通过环境变量控制是否使用模拟数据

```javascript
// 可以这样处理
const USE_MOCK_DATA = import.meta.env.VITE_USE_MOCK === 'true'

async loadEmployees() {
  if (USE_MOCK_DATA) {
    // 使用模拟数据
    this.employees = MOCK_EMPLOYEES_DATA
  } else {
    // 调用真实API
    const response = await api.get('/enterprises/employees/')
    this.employees = response.data
  }
}
```

### 3. 创建统一的数据加载方法
```javascript
// utils/dataLoader.js
export const createDataLoader = (apiEndpoint, mockData) => {
  return async function() {
    if (USE_MOCK_DATA) {
      return mockData
    }
    const response = await api.get(apiEndpoint)
    return response.data.results || response.data
  }
}
```

---

## 📊 总结

### 当前状态
- ✅ 前端页面显示正常（使用模拟数据）
- ✅ 按钮功能已修复（但API未连接）
- ❌ 没有连接真实的后端API
- ❌ 数据不会保存到数据库

### 需要做的工作
- [ ] 连接所有页面的后端API（预计10-15天）
- [ ] 或者创建数据库初始化脚本（预计2-3天）
- [ ] 添加加载状态和错误处理
- [ ] 完整测试所有功能

### 最终目标
让前端页面显示的所有数据都来自数据库，而不是硬编码的假数据。

