# ğŸš€ å¿«é€Ÿæµ‹è¯•ç®¡ç†å‘˜æƒé™ - ä¿®æ­£ç‰ˆ

## é‡è¦æç¤º

âš ï¸ **user store ä¸ä¼šæŒä¹…åŒ–åˆ° localStorage**ï¼Œåªæœ‰ `token` ä¼šä¿å­˜ã€‚  
âœ… **æ­£ç¡®çš„éªŒè¯æ–¹å¼æ˜¯æŸ¥çœ‹ç™»å½•æ—¶çš„ Network è¯·æ±‚**ã€‚

---

## æµ‹è¯•æ­¥éª¤

### 1ï¸âƒ£ é‡å¯åç«¯æœåŠ¡

```bash
# åœ¨åç«¯ç›®å½•ï¼ŒæŒ‰ Ctrl+C åœæ­¢
cd backend
python manage.py runserver
```

### 2ï¸âƒ£ æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

1. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
2. **Application** æ ‡ç­¾ â†’ **Local Storage**
3. åˆ é™¤ `token` å’Œ `refreshToken`
4. åˆ·æ–°é¡µé¢

### 3ï¸âƒ£ æ‰“å¼€ Network æ ‡ç­¾

- **F12** â†’ **Network** æ ‡ç­¾
- å‹¾é€‰ **Preserve log**ï¼ˆä¿ç•™æ—¥å¿—ï¼‰
- å‡†å¤‡ç›‘æ§ç™»å½•è¯·æ±‚

### 4ï¸âƒ£ æµ‹è¯•ç™»å½•

1. è®¿é—® http://localhost:5173/login
2. ç‚¹å‡»**ç»¿è‰²çš„"ç³»ç»Ÿç®¡ç†å‘˜"**æŒ‰é’®
3. è§‚å¯Ÿ Network æ ‡ç­¾

---

## âœ… éªŒè¯æƒé™æ˜¯å¦æ­£å¸¸

### æ–¹æ³•1ï¼šæŸ¥çœ‹ç™»å½•å“åº”ï¼ˆæ¨èï¼‰

åœ¨ **Network** æ ‡ç­¾ä¸­ï¼š

1. æ‰¾åˆ° `login` è¯·æ±‚ï¼ˆæˆ– `auth/login/`ï¼‰
2. ç‚¹å‡»å®ƒ
3. æŸ¥çœ‹ **Response** æ ‡ç­¾

**åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å“åº”**ï¼š

```json
{
  "access": "eyJ0eXAiOiJKV1Qi...",
  "refresh": "eyJ0eXAiOiJKV1Qi...",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@corrosion-platform.com",
    "first_name": "ç³»ç»Ÿ",
    "last_name": "ç®¡ç†å‘˜",
    "user_type": "personal",
    "is_staff": true,        âœ… å¿…é¡»æ˜¯ true
    "is_superuser": true,    âœ… å¿…é¡»æ˜¯ true
    "roles": [
      {
        "id": 1,
        "name": "ç³»ç»Ÿç®¡ç†å‘˜",
        "code": "admin"
      }
    ]
  }
}
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- âœ… `user.is_staff` åº”è¯¥æ˜¯ `true`
- âœ… `user.is_superuser` åº”è¯¥æ˜¯ `true`
- âœ… å¦‚æœè¿™ä¸¤ä¸ªå­—æ®µå­˜åœ¨ä¸”ä¸º `true`ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼

### æ–¹æ³•2ï¼šåœ¨ç™»å½•åç«‹å³æŸ¥çœ‹ï¼ˆæ¨èï¼‰

ç™»å½•æˆåŠŸåï¼Œ**ç«‹å³**åœ¨æ§åˆ¶å°ï¼ˆConsoleï¼‰è¾“å…¥ï¼š

```javascript
// æ³¨æ„ï¼šå¿…é¡»åœ¨ç™»å½•åç«‹å³æ‰§è¡Œ
import { useUserStore } from '@/stores/user'
const userStore = useUserStore()

console.log('=== ç”¨æˆ·ä¿¡æ¯ ===')
console.log('ç”¨æˆ·å:', userStore.user?.username)
console.log('is_staff:', userStore.user?.is_staff)
console.log('is_superuser:', userStore.user?.is_superuser)
console.log('isAdmin:', userStore.isAdmin)
```

å¦‚æœä¸Šé¢çš„ä¸å·¥ä½œï¼ˆå› ä¸ºæ¨¡å—å¯¼å…¥é—®é¢˜ï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªï¼š

```javascript
// è¿™ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨
console.log('Token å­˜åœ¨:', !!localStorage.getItem('token'))
```

### æ–¹æ³•3ï¼šæŸ¥çœ‹é¡µé¢è·³è½¬

æœ€ç®€å•çš„éªŒè¯æ–¹æ³•ï¼š

1. ç‚¹å‡»"ç³»ç»Ÿç®¡ç†å‘˜"ç™»å½•æŒ‰é’®
2. **å¦‚æœèƒ½æˆåŠŸè·³è½¬åˆ° `/dashboard/system` é¡µé¢**
3. **èƒ½çœ‹åˆ°ç³»ç»Ÿç®¡ç†çš„ç»Ÿè®¡æ•°æ®**
4. âœ… è¯´æ˜æƒé™æ­£å¸¸ï¼

---

## ğŸ” è¯¦ç»†æ£€æŸ¥æ­¥éª¤

### Step 1: æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®

**æ‰“å¼€æ–°ç»ˆç«¯ï¼Œæµ‹è¯•åç«¯åºåˆ—åŒ–å™¨**ï¼š

```bash
cd backend
python manage.py shell -c "from apps.users.models import User; from apps.users.serializers import UserSerializer; admin = User.objects.filter(username='admin').first(); data = UserSerializer(admin).data; print('âœ“ æµ‹è¯•åç«¯åºåˆ—åŒ–'); print('is_staff:', data.get('is_staff')); print('is_superuser:', data.get('is_superuser'))"
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ“ æµ‹è¯•åç«¯åºåˆ—åŒ–
is_staff: True
is_superuser: True
```

å¦‚æœè¾“å‡ºæ˜¯ `None` æˆ– `False`ï¼Œè¯´æ˜åç«¯åºåˆ—åŒ–å™¨è¿˜æœ‰é—®é¢˜ã€‚

### Step 2: æ£€æŸ¥ API è¯·æ±‚

1. **æ‰“å¼€ Postman** æˆ–ä½¿ç”¨ **curl**ï¼š

```bash
# 1. å…ˆç™»å½•è·å– token
curl -X POST http://localhost:8000/api/v1/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

2. **æŸ¥çœ‹å“åº”**ï¼Œç¡®è®¤åŒ…å« `is_staff` å’Œ `is_superuser` å­—æ®µ

### Step 3: æŸ¥çœ‹å‰ç«¯æ—¥å¿—

ç™»å½•æ—¶ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°åº”è¯¥èƒ½çœ‹åˆ°ï¼š

```
ç™»å½•æˆåŠŸ
æ­£åœ¨è·³è½¬...
```

å¦‚æœçœ‹åˆ°é”™è¯¯æ¶ˆæ¯ï¼Œè®°å½•ä¸‹æ¥ä»¥ä¾¿æ’æŸ¥ã€‚

---

## âŒ å¸¸è§é—®é¢˜

### é—®é¢˜1: Network ä¸­æ²¡æœ‰çœ‹åˆ° login è¯·æ±‚

**åŸå› **ï¼šå¯èƒ½å¤ªå¿«ï¼Œè¯·æ±‚å·²ç»å®Œæˆäº†

**è§£å†³**ï¼š
1. åˆ·æ–°é¡µé¢
2. å…ˆæ‰“å¼€ Network æ ‡ç­¾
3. å‹¾é€‰ "Preserve log"
4. å†ç‚¹å‡»ç™»å½•æŒ‰é’®

### é—®é¢˜2: å“åº”ä¸­æ²¡æœ‰ is_staff å­—æ®µ

**åŸå› **ï¼šåç«¯è¿˜æ²¡æœ‰é‡å¯

**è§£å†³**ï¼š
```bash
# åœæ­¢åç«¯ (Ctrl+C)
cd backend
python manage.py runserver
```

### é—®é¢˜3: ç™»å½•åä»ç„¶æ˜¾ç¤º"æ²¡æœ‰æƒé™"

**æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹**ï¼š

1. **åç«¯æ˜¯å¦è¿”å›äº† is_staff**
   - Network â†’ login è¯·æ±‚ â†’ Response
   - æŸ¥æ‰¾ `"is_staff": true`

2. **å‰ç«¯æ˜¯å¦èƒ½æ­£ç¡®è¯»å–**
   - ç™»å½•ååœ¨ Console æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯

3. **è·¯ç”±å®ˆå«æ˜¯å¦æ­£ç¡®**
   - æ£€æŸ¥ `frontend/src/router/index.js`

---

## ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹

### æµ‹è¯•æ¸…å•

- [ ] 1. åç«¯å·²é‡å¯
- [ ] 2. æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤ï¼ˆtoken åˆ é™¤ï¼‰
- [ ] 3. Network æ ‡ç­¾å·²æ‰“å¼€å¹¶å‹¾é€‰ "Preserve log"
- [ ] 4. ç‚¹å‡»"ç³»ç»Ÿç®¡ç†å‘˜"ç™»å½•æŒ‰é’®
- [ ] 5. æŸ¥çœ‹ Network ä¸­çš„ login å“åº”
- [ ] 6. ç¡®è®¤å“åº”åŒ…å« `"is_staff": true`
- [ ] 7. ç¡®è®¤é¡µé¢è·³è½¬åˆ° `/dashboard/system`
- [ ] 8. ç¡®è®¤èƒ½çœ‹åˆ°ç³»ç»Ÿç®¡ç†æ•°æ®

å…¨éƒ¨ âœ… = æƒé™æ­£å¸¸ï¼

---

## ğŸ“¸ æˆªå›¾å‚è€ƒ

### æ­£ç¡®çš„ Network å“åº”åº”è¯¥æ˜¯ï¼š

```
Status: 200 OK
Response:
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "user": {
    "id": 1,
    "username": "admin",
    "is_staff": true,         â† çœ‹è¿™é‡Œï¼
    "is_superuser": true,     â† çœ‹è¿™é‡Œï¼
    ...
  }
}
```

### æ­£ç¡®çš„é¡µé¢è·³è½¬ï¼š

```
ç™»å½•å‰: http://localhost:5173/login
        â†“ ç‚¹å‡»"ç³»ç»Ÿç®¡ç†å‘˜"
ç™»å½•å: http://localhost:5173/dashboard/system  â† è‡ªåŠ¨è·³è½¬
```

---

## ğŸ†˜ ä»ç„¶æœ‰é—®é¢˜ï¼Ÿ

### æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **åç«¯æµ‹è¯•è¾“å‡º**ï¼š
   ```bash
   python manage.py shell -c "from apps.users.models import User; from apps.users.serializers import UserSerializer; admin = User.objects.filter(username='admin').first(); print('is_staff:', UserSerializer(admin).data.get('is_staff'))"
   ```

2. **Network å“åº”æˆªå›¾**ï¼š
   - F12 â†’ Network â†’ login è¯·æ±‚ â†’ Response æ ‡ç­¾

3. **Console é”™è¯¯ä¿¡æ¯**ï¼š
   - F12 â†’ Console â†’ æ‰€æœ‰çº¢è‰²é”™è¯¯

4. **æ˜¯å¦æˆåŠŸè·³è½¬**ï¼š
   - ç™»å½•åçš„ URL æ˜¯ä»€ä¹ˆï¼Ÿ

---

## âœ… é¢„æœŸç»“æœ

**å¦‚æœä¸€åˆ‡æ­£å¸¸**ï¼š

1. âœ… ç‚¹å‡»"ç³»ç»Ÿç®¡ç†å‘˜"æŒ‰é’®
2. âœ… çœ‹åˆ° "ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼" æç¤º
3. âœ… è‡ªåŠ¨è·³è½¬åˆ° `/dashboard/system`
4. âœ… èƒ½çœ‹åˆ°ç³»ç»Ÿç»Ÿè®¡æ•°æ®ï¼ˆç”¨æˆ·æ•°ã€è§’è‰²æ•°ç­‰ï¼‰
5. âœ… Network å“åº”åŒ…å« `is_staff: true`
6. âœ… å·¦ä¾§èœå•æ˜¾ç¤ºç³»ç»Ÿç®¡ç†é€‰é¡¹

**å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æˆªå›¾ Network å“åº”ï¼Œæˆ‘ä¼šç»§ç»­å¸®æ‚¨æ’æŸ¥ï¼**

---

**æœ€åæ›´æ–°**: 2024-10-21  
**çŠ¶æ€**: âœ… ä¿®å¤å®Œæˆï¼Œè¯·æŒ‰æ­¤æ–‡æ¡£æµ‹è¯•


