# 快速验证指南 - 角色和菜单功能

## 🚀 快速开始

### 1. 确保服务正在运行

```bash
# 后端服务（端口8000）
cd backend
python manage.py runserver

# 前端服务（端口5174）- 新终端窗口
cd frontend
npm run dev
```

### 2. 访问系统

打开浏览器访问：**http://localhost:5174**

## ✅ 验证清单

### 验证1: 新用户注册并查看菜单

1. **访问注册页面**
   - 地址：http://localhost:5174/register

2. **注册个人用户**
   - 用户类型：选择"个人用户"
   - 用户名：testpersonal（任意唯一用户名）
   - 姓名：测试个人
   - 邮箱：test@example.com
   - 手机号：13900000001（任意未使用的手机号）
   - 密码：123456
   - 确认密码：123456

3. **登录并验证菜单**
   - 登录后应该看到左侧菜单栏
   - **预期菜单**：
     - ✓ 仪表板
     - ✓ 个人中心（展开后有：个人信息、我的项目、我的任务）
     - ✓ 信息广场
     - ✓ 资源管理

### 验证2: 企业用户注册

1. **注册企业用户**
   - 用户类型：选择"企业用户"
   - 其他信息同上（使用不同的用户名和手机号）

2. **登录并验证菜单**
   - **预期菜单**：
     - ✓ 仪表板
     - ✓ 企业中心（展开后有：企业信息、项目管理、员工管理）
     - ✓ 信息广场（可发布信息）
     - ✓ 资源管理（可添加资源）

### 验证3: 已存在用户

如果你之前已经注册过用户，需要为他们分配角色：

```bash
cd backend
python assign_roles_to_existing_users.py
```

然后重新登录即可看到菜单。

## 📊 预期结果对比

### 个人用户菜单结构

```
├── 仪表板
├── 个人中心
│   ├── 个人信息
│   ├── 我的项目
│   └── 我的任务
├── 信息广场
│   └── 信息浏览
└── 资源管理
    └── 资源浏览
```

### 企业用户菜单结构

```
├── 仪表板
├── 企业中心
│   ├── 企业信息
│   ├── 项目管理
│   └── 员工管理
├── 信息广场
│   ├── 信息浏览
│   └── 发布信息
└── 资源管理
    ├── 资源浏览
    └── 添加资源
```

## 🔧 如果问题仍未解决

### 步骤1: 检查角色菜单是否已初始化

```bash
cd backend
python init_role_menus.py
```

应该看到类似输出：
```
✓ 系统管理员: 19个菜单
✓ 企业管理员: 11个菜单
✓ 企业员工: 8个菜单
✓ 个人用户: 9个菜单
```

### 步骤2: 为现有用户分配角色

```bash
python assign_roles_to_existing_users.py
```

### 步骤3: 清除浏览器缓存

- Chrome/Edge: `Ctrl + Shift + Delete`
- 或使用无痕模式重新测试

### 步骤4: 检查后端日志

查看 `backend/logs/django.log` 或控制台输出，查找错误信息。

### 步骤5: 检查数据库

```bash
cd backend
python manage.py shell
```

```python
from apps.users.models import User, UserRole, Role, RoleMenu

# 检查用户角色
user = User.objects.get(username='你的用户名')
roles = UserRole.objects.filter(user=user)
print(f"用户角色: {[r.role.name for r in roles]}")

# 检查角色菜单
for ur in roles:
    menu_count = RoleMenu.objects.filter(role=ur.role).count()
    print(f"{ur.role.name}: {menu_count}个菜单")
```

## 🎯 测试要点

| 测试项 | 预期结果 | 实际结果 |
|--------|----------|----------|
| 个人用户注册 | ✓ 自动分配"个人用户"角色 | □ |
| 个人用户登录 | ✓ 显示9个菜单 | □ |
| 企业用户注册 | ✓ 自动分配"企业管理员"角色 | □ |
| 企业用户登录 | ✓ 显示11个菜单 | □ |
| 菜单导航 | ✓ 可以点击访问各个页面 | □ |
| 权限隔离 | ✓ 个人/企业用户看到不同菜单 | □ |

## 📞 获取帮助

如果遇到问题：

1. **查看日志**：`backend/logs/django.log`
2. **查看文档**：`角色菜单分配说明.md`
3. **重新初始化**：
   ```bash
   cd backend
   python init_role_menus.py
   python assign_roles_to_existing_users.py
   ```

## ✨ 成功标志

当你看到：
- ✅ 注册后自动分配角色
- ✅ 登录后显示菜单
- ✅ 可以点击菜单导航
- ✅ 个人和企业用户菜单不同

**恭喜！系统已经正常工作了！** 🎉


