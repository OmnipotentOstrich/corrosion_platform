# 接口测试快速开始指南

## 🎯 目标
快速验证前后端接口是否正确对接并可以正常通信。

## ⚡ 5分钟快速测试

### 步骤1: 启动后端 (1分钟)
```bash
# 打开终端1
cd backend
python manage.py runserver
```

等待看到:
```
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 步骤2: 启动前端 (1分钟)
```bash
# 打开终端2
cd frontend
npm run dev
```

等待看到:
```
  ➜  Local:   http://localhost:5173/
```

### 步骤3: 运行快速测试 (30秒)
```bash
# 打开终端3
python quick_test.py
```

**预期输出:**
```
************************************************************
*               前后端接口快速测试                *
************************************************************
============================================================
测试后端服务连接...
============================================================
✓ 后端服务正常运行
  Swagger文档: http://localhost:8000/swagger/

============================================================
测试登录接口...
============================================================
✓ admin        登录成功
✓ enterprise   登录成功
✓ personal     登录成功

============================================================
测试常用API端点...
============================================================
✓ 获取用户信息            - GET /auth/profile/
✓ 获取用户菜单            - GET /auth/user-menus/
✓ 仪表板统计              - GET /dashboard/statistics/
...

结果: 10个成功, 0个失败
```

### 步骤4: 浏览器测试 (2分钟)
1. 打开浏览器访问 http://localhost:5173/login
2. 按`F12`打开开发者工具，切换到Network标签
3. 点击"系统管理员"一键登录
4. 观察Network中的请求:
   - ✅ 看到 `POST /auth/login/` 返回200
   - ✅ 看到 `GET /auth/user-menus/` 返回200
   - ✅ 页面跳转到仪表板

🎉 **如果以上都成功，说明前后端接口基本对接正常！**

---

## 📚 深入测试

### 测试核心功能 (10分钟)

#### 1. 测试企业模块
```
1. 登录企业账号 (enterprise / enterprise123)
2. 访问 /dashboard/enterprise/projects
3. 点击"新建项目"
4. 检查Network中是否有:
   - POST /enterprises/projects/ → 201 Created
5. 刷新页面，项目是否显示在列表中
```

#### 2. 测试个人模块
```
1. 登录个人账号 (user / user123)
2. 访问 /dashboard/personal/tasks
3. 如果有任务，尝试:
   - 点击"完成"按钮
   - 检查 POST /persons/tasks/{id}/complete/
   - 点击"编辑"按钮
   - 保存后检查 PUT /persons/tasks/{id}/
```

#### 3. 测试信息广场
```
1. 访问 /dashboard/info-plaza
2. 尝试点赞
   - 检查 POST /info-plaza/posts/{id}/like/
   - 点赞数是否增加
3. 尝试搜索和筛选
   - 检查URL参数是否正确
```

---

## 🐛 常见问题

### Q1: 后端无法启动
**症状:** `python manage.py runserver` 报错

**解决方案:**
```bash
# 检查Python虚拟环境
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 数据库迁移
python manage.py migrate

# 创建测试数据
python manage.py populate_initial_data
```

### Q2: 前端无法启动
**症状:** `npm run dev` 报错

**解决方案:**
```bash
cd frontend

# 删除node_modules重新安装
rm -rf node_modules package-lock.json  # Windows: del /s /q node_modules package-lock.json
npm install

# 重新启动
npm run dev
```

### Q3: 登录返回401
**症状:** 登录请求返回401 Unauthorized

**原因:** 测试账号不存在

**解决方案:**
```bash
cd backend

# 重新初始化数据
python manage.py populate_initial_data

# 或手动创建超级用户
python manage.py createsuperuser
```

### Q4: CORS错误
**症状:** 浏览器Console显示CORS错误

**解决方案:**
确认`backend/config/settings.py`中有:
```python
INSTALLED_APPS = [
    ...
    'corsheaders',
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    ...
]

CORS_ALLOW_ALL_ORIGINS = True  # 开发环境
```

---

## 📖 详细文档

根据你的需求选择合适的文档：

### 1. 我想了解接口对接情况
👉 阅读 `接口对接测试总结.md`
- 查看哪些接口已对接
- 了解完成度统计
- 查看待实现功能

### 2. 我想在浏览器中手动测试
👉 阅读 `浏览器端接口测试指南.md`
- 详细的测试步骤
- 预期的Network请求
- 常见问题排查
- Console测试脚本

### 3. 我想运行自动化测试
👉 运行 `python test_api_integration.py`
- 测试所有API端点
- 生成JSON格式报告
- 彩色终端输出

### 4. 我想查看完整的接口文档
👉 阅读 `前后端接口完整测试报告.md`
- 所有接口的详细列表
- 前后端对照关系
- API调用示例

---

## 🎯 测试目标检查清单

### 基础功能 (必测)
- [ ] 管理员账号可以登录
- [ ] 企业账号可以登录
- [ ] 个人账号可以登录
- [ ] 登录后获得token
- [ ] Token保存到localStorage
- [ ] 仪表板数据正常加载

### 企业功能
- [ ] 可以查看企业项目列表
- [ ] 可以创建新项目
- [ ] 可以查看员工列表
- [ ] 可以添加员工

### 个人功能
- [ ] 可以查看个人项目
- [ ] 可以查看个人任务
- [ ] 可以完成任务
- [ ] 可以编辑任务

### 信息广场
- [ ] 可以浏览信息列表
- [ ] 可以搜索信息
- [ ] 可以筛选信息类型
- [ ] 可以点赞/取消点赞

### 系统管理
- [ ] 可以查看用户列表
- [ ] 可以搜索用户
- [ ] 可以禁用/启用用户

---

## 💡 测试技巧

### 技巧1: 使用浏览器Console快速测试API
```javascript
// 获取token
const token = localStorage.getItem('token')

// 测试任意API
fetch('http://localhost:8000/api/v1/auth/profile/', {
  headers: { 'Authorization': `Bearer ${token}` }
})
.then(r => r.json())
.then(console.log)
```

### 技巧2: 使用Postman/Insomnia测试API
1. 导入Swagger文档: http://localhost:8000/swagger.json
2. 先调用登录接口获取token
3. 在Headers中添加: `Authorization: Bearer {token}`
4. 测试其他接口

### 技巧3: 查看Django日志
```bash
# 查看实时日志
tail -f backend/logs/django.log

# 或者在后端控制台直接查看输出
```

### 技巧4: 使用Vue Devtools
1. 安装Vue Devtools浏览器扩展
2. 打开前端页面
3. 按F12，切换到Vue标签
4. 查看组件状态、Vuex store、API调用

---

## 🚀 下一步

测试通过后，你可以:

1. **修复资源管理模块**
   - 编辑 `frontend/src/views/resources/index.vue`
   - 连接到真实API

2. **实现信息发布功能**
   - 创建 `frontend/src/views/info-plaza/Publish.vue`
   - 连接到 `POST /info-plaza/posts/` API

3. **实现其他待完成功能**
   - 参考 `接口对接测试总结.md` 中的待实现列表

---

## 📞 获取帮助

如果遇到问题:

1. **查看详细文档**
   - 浏览器端接口测试指南.md
   - 前后端接口完整测试报告.md

2. **查看日志**
   - 后端: backend/logs/django.log
   - 前端: 浏览器Console

3. **运行自动化测试**
   ```bash
   python test_api_integration.py
   ```

4. **访问API文档**
   - http://localhost:8000/swagger/
   - http://localhost:8000/redoc/

---

**祝测试顺利！** 🎉




