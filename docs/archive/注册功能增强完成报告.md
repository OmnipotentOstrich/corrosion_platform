# 注册功能增强 - 用户类型和角色选择

## 功能概述

已成功实现了注册时的用户类型选择和角色分配功能，用户可以在注册时选择个人用户或企业用户，并根据选择的用户类型选择相应的专业角色。

## 实现的功能

### 1. 专业角色扩展

添加了以下专业角色：

**个人用户可选角色：**
- 个人用户 (personal_user)
- 技术人员 (technician) - 从事技术工作的专业人员
- 工程师 (engineer) - 具有工程专业背景的技术人员
- 施工人员 (construction_worker) - 从事现场施工工作的人员
- 劳务人员 (labor_worker) - 从事基础劳务工作的人员
- 行业顾问 (industry_consultant) - 具有丰富行业经验的专业顾问
- 行业专家 (industry_expert) - 在特定领域具有权威地位的专业专家

**企业用户可选角色：**
- 企业管理员 (enterprise_admin)
- 企业员工 (enterprise_employee)
- 项目经理 (project_manager) - 负责项目整体管理和协调
- 质量监督员 (quality_supervisor) - 负责质量控制和监督工作
- 安全管理员 (safety_manager) - 负责安全管理和监督工作
- 材料管理员 (material_manager) - 负责材料采购、管理和库存控制

### 2. 后端API增强

#### 新增API接口
- `GET /api/v1/auth/available-roles/?user_type={type}` - 获取可选择的角色列表
  - 根据用户类型（personal/enterprise）返回相应的角色选项
  - 支持角色描述信息

#### 注册接口增强
- `POST /api/v1/auth/register/` - 支持角色选择的注册接口
  - 新增 `role_id` 参数，允许用户选择特定角色
  - 如果未选择角色，系统会根据用户类型自动分配默认角色
  - 支持角色验证，确保选择的角色存在且可用

### 3. 前端界面优化

#### 注册页面改进
- 添加了角色选择下拉框
- 根据用户类型动态加载可选择的角色列表
- 角色选项显示角色名称和描述信息
- 用户类型切换时自动清空角色选择
- 添加了角色选择的表单验证

#### 用户体验提升
- 角色选择框支持搜索和过滤
- 加载状态指示器
- 错误处理和用户反馈
- 响应式设计，支持移动端

### 4. 权限和菜单管理

为每个专业角色配置了相应的菜单权限：

**技术人员、施工人员、质量监督员、安全管理员、材料管理员：**
- 仪表板、个人中心、信息广场、资源管理
- 基础功能访问权限

**工程师、行业顾问、行业专家、项目经理：**
- 仪表板、个人中心、信息广场、资源管理
- 额外包含信息发布和资源添加权限

**劳务人员：**
- 仪表板、个人中心、信息广场、资源管理
- 不包含项目管理功能

## 技术实现细节

### 后端实现

1. **角色数据初始化**
   - 创建了 `add_professional_roles.py` 脚本
   - 自动添加专业角色到数据库
   - 为每个角色配置相应的菜单权限

2. **序列化器增强**
   - `UserCreateSerializer` 支持 `role_id` 参数
   - 添加角色验证逻辑
   - 支持自动角色分配

3. **视图层优化**
   - 新增 `available_roles` API端点
   - 根据用户类型过滤角色列表
   - 支持角色描述信息返回

### 前端实现

1. **状态管理**
   - 在 `user.js` store中添加 `getAvailableRoles` 方法
   - 支持按用户类型获取角色列表

2. **组件增强**
   - 注册页面添加角色选择组件
   - 动态加载和验证逻辑
   - 用户类型切换处理

3. **样式优化**
   - 角色选择框的现代化设计
   - 角色选项的详细信息展示
   - 响应式布局支持

## 使用说明

### 注册流程

1. **选择用户类型**
   - 个人用户：适合个人专业技术人员
   - 企业用户：适合企业管理人员和员工

2. **选择角色**
   - 个人用户可选择：技术人员、工程师、施工人员、劳务人员、行业顾问、行业专家
   - 企业用户可选择：企业管理员、企业员工、项目经理、质量监督员、安全管理员、材料管理员

3. **填写基本信息**
   - 用户名、姓名、邮箱、手机号
   - 密码和确认密码

4. **提交注册**
   - 系统验证所有信息
   - 创建用户并分配选择的角色
   - 自动跳转到登录页面

### API使用示例

```javascript
// 获取个人用户可选角色
GET /api/v1/auth/available-roles/?user_type=personal

// 获取企业用户可选角色
GET /api/v1/auth/available-roles/?user_type=enterprise

// 注册用户并选择角色
POST /api/v1/auth/register/
{
  "user_type": "personal",
  "username": "test_user",
  "first_name": "测试用户",
  "email": "test@example.com",
  "phone": "13800138000",
  "password": "password123",
  "password_confirm": "password123",
  "role_id": 5  // 技术人员角色ID
}
```

## 测试验证

已通过以下测试：

1. ✅ 角色数据成功添加到数据库
2. ✅ API接口正常返回角色列表
3. ✅ 注册接口支持角色选择
4. ✅ 前端界面正确显示角色选项
5. ✅ 用户类型切换功能正常
6. ✅ 表单验证和错误处理

## 后续优化建议

1. **角色权限细化**
   - 为不同角色配置更精细的权限控制
   - 支持角色权限的动态调整

2. **企业信息完善**
   - 企业用户注册时要求填写企业基本信息
   - 企业认证流程

3. **角色推荐**
   - 根据用户填写的专业信息推荐合适的角色
   - 智能角色匹配

4. **批量角色管理**
   - 支持管理员批量分配角色
   - 角色变更历史记录

## 总结

本次功能增强成功实现了注册时的用户类型和角色选择功能，为防腐保温智能数字平台提供了更精细化的用户管理能力。用户可以根据自己的专业背景和职业需求选择合适的角色，系统会根据角色分配相应的权限和功能访问权限，提升了平台的用户体验和管理效率。
