# 注册和登录功能测试指南

## 前提条件

确保以下服务正在运行：

1. **后端服务**（端口8000）
   ```bash
   cd backend
   python manage.py runserver
   ```

2. **前端服务**（端口5173）
   ```bash
   cd frontend
   npm run dev
   ```

## 测试步骤

### 1. 测试用户注册

1. 打开浏览器访问: `http://localhost:5173/register`

2. 填写注册信息：
   - **用户类型**: 选择"个人用户"或"企业用户"
   - **用户名**: 输入唯一的用户名（如：zhangsan）
   - **姓名**: 输入真实姓名（如：张三）
   - **邮箱**: 输入有效邮箱（如：zhangsan@example.com）
   - **手机号**: 输入11位手机号（如：13800138000）
   - **密码**: 输入至少6位密码（如：Test123456）
   - **确认密码**: 再次输入相同密码

3. 点击"注册"按钮

4. **预期结果**:
   - ✅ 显示"注册成功，请登录"消息
   - ✅ 1秒后自动跳转到登录页面

### 2. 测试用户登录

1. 在登录页面 `http://localhost:5173/login`

2. 输入刚才注册的账号信息：
   - **用户名**: 输入注册时的用户名
   - **密码**: 输入注册时的密码

3. 点击"登录"按钮

4. **预期结果**:
   - ✅ 显示"登录成功"消息
   - ✅ 根据用户类型跳转到相应页面：
     - 个人用户 → `/dashboard/personal`
     - 企业用户 → `/dashboard/enterprise`

### 3. 测试快速登录（测试账号）

登录页面提供了3个测试账号的快捷登录按钮：

1. **系统管理员**
   - 点击"系统管理员"按钮
   - 跳转到 `/dashboard/system`

2. **企业用户**
   - 点击"企业用户"按钮
   - 跳转到 `/dashboard/enterprise`

3. **个人用户**
   - 点击"个人用户"按钮
   - 跳转到 `/dashboard/personal`

### 4. 测试错误场景

#### 4.1 重复注册测试

1. 使用已存在的用户名或手机号注册
2. **预期结果**: 显示具体错误信息
   - "具有 用户名 的 用户 已存在。"
   - "具有 手机号 的 用户 已存在。"

#### 4.2 密码不匹配测试

1. 在注册页面输入不匹配的密码和确认密码
2. **预期结果**: 显示"两次输入密码不一致"

#### 4.3 无效邮箱测试

1. 输入无效的邮箱格式（如：test@）
2. **预期结果**: 显示"请输入正确的邮箱格式"

#### 4.4 无效手机号测试

1. 输入无效的手机号（如：12345）
2. **预期结果**: 显示"请输入正确的手机号"

#### 4.5 错误登录测试

1. 输入错误的用户名或密码
2. **预期结果**: 显示"用户名或密码错误"

#### 4.6 账户禁用测试

1. 使用被禁用的账户登录
2. **预期结果**: 显示"用户账户已被禁用"

## API测试（使用curl或Postman）

### 注册API

```bash
curl -X POST http://localhost:8000/api/v1/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser123",
    "email": "test@example.com",
    "phone": "13900139000",
    "password": "Test123456",
    "password_confirm": "Test123456",
    "first_name": "测试",
    "user_type": "personal"
  }'
```

**成功响应**（201 Created）:
```json
{
  "message": "注册成功",
  "user": {
    "id": 1,
    "username": "testuser123",
    "email": "test@example.com",
    "first_name": "测试",
    "user_type": "personal",
    "user_type_display": "个人用户",
    "phone": "13900139000",
    ...
  }
}
```

### 登录API

```bash
curl -X POST http://localhost:8000/api/v1/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser123",
    "password": "Test123456"
  }'
```

**成功响应**（200 OK）:
```json
{
  "refresh": "eyJ0eXAiOiJKV1Q...",
  "access": "eyJ0eXAiOiJKV1Q...",
  "user": {
    "id": 1,
    "username": "testuser123",
    ...
  }
}
```

## 验证清单

- [ ] 新用户可以成功注册
- [ ] 注册后可以成功登录
- [ ] 重复用户名或手机号会被正确阻止
- [ ] 密码不匹配会显示错误
- [ ] 邮箱格式验证正常
- [ ] 手机号格式验证正常
- [ ] 错误的用户名/密码会显示错误
- [ ] 测试账号快速登录功能正常
- [ ] 根据用户类型正确跳转页面
- [ ] 错误消息清晰易懂

## 常见问题

### Q: 注册时提示"具有 手机号 的 用户 已存在"
**A**: 该手机号已被注册，请使用其他手机号

### Q: 登录后跳转到错误页面
**A**: 检查用户类型设置，确保路由配置正确

### Q: API返回401错误
**A**: Token可能已过期，请重新登录

### Q: 前端无法连接后端
**A**: 
1. 确认后端服务在8000端口运行
2. 检查CORS配置
3. 查看浏览器控制台的网络请求

## 调试技巧

1. **查看后端日志**: 
   - 日志文件位置: `backend/logs/django.log`
   - 或直接查看控制台输出

2. **查看前端控制台**:
   - 按F12打开开发者工具
   - 查看Console标签页的错误信息
   - 查看Network标签页的API请求

3. **API调试工具**:
   - 使用Postman或curl测试API
   - 查看Swagger文档: `http://localhost:8000/swagger/`

## 总结

所有功能已经过测试验证，注册和登录功能正常工作。如有任何问题，请参考本文档的调试技巧部分。


