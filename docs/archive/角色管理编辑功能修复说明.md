# è§’è‰²ç®¡ç†ç¼–è¾‘åŠŸèƒ½ä¿®å¤å®Œæˆ

## âœ… é—®é¢˜å·²ä¿®å¤

**é—®é¢˜åŸå› ï¼š** 
åŸæœ‰çš„`RoleSerializer`åªæ”¯æŒè¯»å–æƒé™ä¿¡æ¯ï¼Œä¸æ”¯æŒæ›´æ–°æƒé™ã€‚å‰ç«¯å‘é€çš„`permission_ids`å­—æ®µæ²¡æœ‰è¢«åç«¯å¤„ç†ï¼Œå¯¼è‡´è§’è‰²ç¼–è¾‘æ—¶æƒé™æ— æ³•æ›´æ–°ã€‚

**ä¿®å¤å†…å®¹ï¼š**

### ğŸ”§ åç«¯ä¿®å¤

#### 1. åˆ›å»ºæ–°çš„è§’è‰²æ›´æ–°åºåˆ—åŒ–å™¨
```python
class RoleUpdateSerializer(serializers.ModelSerializer):
    """è§’è‰²æ›´æ–°åºåˆ—åŒ–å™¨"""
    permission_ids = serializers.ListField(
        child=serializers.IntegerField(),
        write_only=True,
        required=False,
        help_text='æƒé™IDåˆ—è¡¨'
    )
    
    def update(self, instance, validated_data):
        permission_ids = validated_data.pop('permission_ids', None)
        
        # æ›´æ–°è§’è‰²åŸºæœ¬ä¿¡æ¯
        instance = super().update(instance, validated_data)
        
        # æ›´æ–°è§’è‰²æƒé™
        if permission_ids is not None:
            # æ¸…é™¤ç°æœ‰æƒé™
            RolePermission.objects.filter(role=instance).delete()
            
            # æ·»åŠ æ–°æƒé™
            for permission_id in permission_ids:
                try:
                    permission = Permission.objects.get(id=permission_id)
                    RolePermission.objects.create(role=instance, permission=permission)
                except Permission.DoesNotExist:
                    logger.error(f"æƒé™ID {permission_id} ä¸å­˜åœ¨")
        
        return instance
```

#### 2. æ›´æ–°è§’è‰²è¯¦æƒ…è§†å›¾
```python
class RoleDetailView(generics.RetrieveUpdateDestroyAPIView):
    """è§’è‰²è¯¦æƒ…"""
    queryset = Role.objects.all()
    permission_classes = [permissions.IsAuthenticated, IsAdminOrReadOnly]
    
    def get_serializer_class(self):
        if self.request.method in ['PUT', 'PATCH']:
            return RoleUpdateSerializer  # æ›´æ–°æ—¶ä½¿ç”¨æ–°åºåˆ—åŒ–å™¨
        return RoleSerializer  # è¯»å–æ—¶ä½¿ç”¨åŸåºåˆ—åŒ–å™¨
```

### ğŸ“ ä¿®å¤è¯¦æƒ…

#### ä¿®å¤å‰çš„é—®é¢˜
- âŒ `RoleSerializer`ä¸æ”¯æŒ`permission_ids`å­—æ®µ
- âŒ è§’è‰²ç¼–è¾‘æ—¶æƒé™æ— æ³•æ›´æ–°
- âŒ å‰ç«¯å‘é€çš„æƒé™æ•°æ®è¢«å¿½ç•¥

#### ä¿®å¤åçš„åŠŸèƒ½
- âœ… æ”¯æŒ`permission_ids`å­—æ®µå¤„ç†
- âœ… è§’è‰²ç¼–è¾‘æ—¶æƒé™æ­£ç¡®æ›´æ–°
- âœ… æ¸…é™¤æ—§æƒé™å¹¶æ·»åŠ æ–°æƒé™
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ§ª æµ‹è¯•ç»“æœ

### è§’è‰²ç¼–è¾‘åŠŸèƒ½æµ‹è¯•
- âœ… è·å–è§’è‰²åˆ—è¡¨æˆåŠŸï¼ˆ14ä¸ªè§’è‰²ï¼‰
- âœ… è·å–æƒé™åˆ—è¡¨æˆåŠŸï¼ˆ20ä¸ªæƒé™ï¼‰
- âœ… è§’è‰²ç¼–è¾‘æˆåŠŸï¼ˆåç§°ã€æè¿°ã€æƒé™éƒ½æ›´æ–°ï¼‰
- âœ… æƒé™æ›´æ–°éªŒè¯æˆåŠŸï¼ˆ3ä¸ªæƒé™æ­£ç¡®åˆ†é…ï¼‰

### æµ‹è¯•è¯¦æƒ…
```
æµ‹è¯•è§’è‰²: ææ–™ç®¡ç†å‘˜ (ID: 25)
æ›´æ–°ååç§°: ææ–™ç®¡ç†å‘˜_ç¼–è¾‘æµ‹è¯•
æ›´æ–°åæè¿°: è´Ÿè´£ææ–™é‡‡è´­ã€ç®¡ç†å’Œåº“å­˜æ§åˆ¶çš„äººå‘˜ - ç¼–è¾‘æµ‹è¯•
è§’è‰²æƒé™æ•°é‡: 3
- ä¼ä¸šç¼–è¾‘ (enterprise_edit)
- ä»ªè¡¨æ¿æŸ¥çœ‹ (dashboard_view)
- ä»ªè¡¨æ¿ç®¡ç† (dashboard_manage)
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

ç°åœ¨è§’è‰²ç®¡ç†ç¼–è¾‘åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼š
- âœ… æ”¯æŒç¼–è¾‘è§’è‰²åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€ä»£ç ã€æè¿°ã€çŠ¶æ€ï¼‰
- âœ… æ”¯æŒæ‰¹é‡æ›´æ–°è§’è‰²æƒé™
- âœ… æƒé™æ›´æ–°é‡‡ç”¨"æ¸…é™¤åæ·»åŠ "ç­–ç•¥
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- âœ… æ”¯æŒæƒé™åˆ†ç»„æ˜¾ç¤ºå’Œå…¨é€‰åŠŸèƒ½

## ğŸ” æƒé™æ›´æ–°é€»è¾‘

### æ›´æ–°æµç¨‹
1. **æ¥æ”¶æƒé™IDåˆ—è¡¨** - å‰ç«¯å‘é€`permission_ids`æ•°ç»„
2. **æ¸…é™¤ç°æœ‰æƒé™** - åˆ é™¤è§’è‰²çš„æ‰€æœ‰ç°æœ‰æƒé™å…³è”
3. **æ·»åŠ æ–°æƒé™** - æ ¹æ®IDåˆ—è¡¨åˆ›å»ºæ–°çš„æƒé™å…³è”
4. **é”™è¯¯å¤„ç†** - ä¸å­˜åœ¨çš„æƒé™IDä¼šè¢«è®°å½•ä½†ä¸å½±å“æ›´æ–°

### æƒé™éªŒè¯
- âœ… éªŒè¯æƒé™IDæ˜¯å¦å­˜åœ¨
- âœ… è®°å½•ä¸å­˜åœ¨çš„æƒé™ID
- âœ… ä¸å½±å“è§’è‰²åŸºæœ¬ä¿¡æ¯æ›´æ–°

## ğŸš€ ä½¿ç”¨æ–¹æ³•

1. è®¿é—®è§’è‰²ç®¡ç†é¡µé¢
2. ç‚¹å‡»è§’è‰²å¡ç‰‡ä¸Šçš„"ç¼–è¾‘"æŒ‰é’®
3. ä¿®æ”¹è§’è‰²ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€çŠ¶æ€ç­‰ï¼‰
4. åœ¨æƒé™é…ç½®åŒºåŸŸé€‰æ‹©/å–æ¶ˆæƒé™
5. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
6. ç³»ç»Ÿä¼šæ›´æ–°è§’è‰²ä¿¡æ¯å’Œæƒé™åˆ†é…

## ğŸ“‹ å‰ç«¯åŠŸèƒ½

### æƒé™é€‰æ‹©ç•Œé¢
- âœ… æŒ‰æ¨¡å—åˆ†ç»„æ˜¾ç¤ºæƒé™
- âœ… æ”¯æŒå…¨é€‰/å–æ¶ˆå…¨é€‰
- âœ… æ”¯æŒå•ç‹¬é€‰æ‹©æƒé™
- âœ… å®æ—¶æ˜¾ç¤ºé€‰æ‹©çŠ¶æ€

### è¡¨å•éªŒè¯
- âœ… è§’è‰²åç§°å¿…å¡«éªŒè¯
- âœ… è§’è‰²ä»£ç æ ¼å¼éªŒè¯
- âœ… å­—ç¬¦é•¿åº¦é™åˆ¶

ç°åœ¨è§’è‰²ç®¡ç†ä¸­çš„ç¼–è¾‘åŠŸèƒ½å·²ç»å®Œå…¨ä¿®å¤å¹¶å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼
