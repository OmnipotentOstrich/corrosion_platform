# ğŸ” è°ƒè¯•ç®¡ç†å‘˜æƒé™é—®é¢˜

## å½“å‰çŠ¶æ€

âœ… **åç«¯å·²ä¿®å¤** - ç™»å½•å“åº”åŒ…å« `is_staff: true` å’Œ `is_superuser: true`  
â“ **å‰ç«¯é—®é¢˜** - æ˜¾ç¤º"æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº"

---

## å¿«é€Ÿè¯Šæ–­

### è¯·å‘Šè¯‰æˆ‘ä»¥ä¸‹ä¿¡æ¯ï¼š

#### 1. ç™»å½•æ—¶çš„æƒ…å†µ
- [ ] æ˜¯å¦çœ‹åˆ°"ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼"çš„æç¤ºï¼Ÿ
- [ ] é¡µé¢URLæ˜¯å¦å˜æˆäº† `/dashboard/system`ï¼Ÿ
- [ ] æ˜¯å¦çœ‹åˆ°äº†ç³»ç»Ÿç®¡ç†é¡µé¢çš„å†…å®¹ï¼ˆç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ç­‰å¡ç‰‡ï¼‰ï¼Ÿ

#### 2. é”™è¯¯å‡ºç°çš„æ—¶æœº
- [ ] ç‚¹å‡»ç™»å½•æŒ‰é’®åç«‹å³æ˜¾ç¤ºé”™è¯¯ï¼Ÿ
- [ ] é¡µé¢è·³è½¬åæ˜¾ç¤ºé”™è¯¯ï¼Ÿ
- [ ] è¿˜æ˜¯è¿›å…¥é¡µé¢ä¸€æ®µæ—¶é—´åæ˜¾ç¤ºï¼Ÿ

#### 3. æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12 â†’ Consoleï¼‰
- æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯ï¼Ÿ
- è¯·æˆªå›¾æˆ–å¤åˆ¶é”™è¯¯ä¿¡æ¯

#### 4. Network è¯·æ±‚ï¼ˆF12 â†’ Networkï¼‰
- é™¤äº† login è¯·æ±‚ï¼Œè¿˜æœ‰å“ªäº›è¯·æ±‚ï¼Ÿ
- å“ªä¸ªè¯·æ±‚è¿”å›äº† 403 çŠ¶æ€ç ï¼Ÿ
- è¯·æ‰¾åˆ°è¿”å› 403 çš„è¯·æ±‚ï¼Œå‘Šè¯‰æˆ‘ï¼š
  - è¯·æ±‚çš„ URL æ˜¯ä»€ä¹ˆï¼Ÿ
  - Response å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ

---

## è°ƒè¯•æ­¥éª¤

### Step 1: æ¸…é™¤ç¼“å­˜å¹¶å®Œæ•´æµ‹è¯•

1. **æ¸…é™¤æ‰€æœ‰å†…å®¹**
   ```
   F12 â†’ Application â†’ Storage â†’ Clear site data
   æˆ–è€…
   F12 â†’ Application â†’ Local Storage â†’ å³é”® Clear
   ```

2. **åˆ·æ–°é¡µé¢** (F5)

3. **æ‰“å¼€ Network æ ‡ç­¾**
   - å‹¾é€‰ "Preserve log"
   - å‹¾é€‰ "Disable cache"

4. **æ‰“å¼€ Console æ ‡ç­¾** 

5. **ç‚¹å‡»"ç³»ç»Ÿç®¡ç†å‘˜"ç™»å½•æŒ‰é’®**

6. **è§‚å¯Ÿå¹¶è®°å½•**ï¼š
   - Console ä¸­çš„æ‰€æœ‰è¾“å‡º
   - Network ä¸­æ‰€æœ‰çš„è¯·æ±‚
   - ç‰¹åˆ«æ³¨æ„çº¢è‰²ï¼ˆå¤±è´¥ï¼‰çš„è¯·æ±‚

### Step 2: æŸ¥çœ‹å…·ä½“çš„403è¯·æ±‚

åœ¨ Network æ ‡ç­¾ä¸­ï¼š
1. æ‰¾åˆ°çŠ¶æ€ç ä¸º **403** çš„è¯·æ±‚
2. ç‚¹å‡»å®ƒ
3. æŸ¥çœ‹ **Headers** æ ‡ç­¾ â†’ Request URL
4. æŸ¥çœ‹ **Response** æ ‡ç­¾ â†’ å“åº”å†…å®¹

**è¯·å‘Šè¯‰æˆ‘**ï¼š
- è¯·æ±‚çš„å®Œæ•´ URL
- Response å†…å®¹

### Step 3: æµ‹è¯•å•ä¸ªAPI

æ‰“å¼€æµè§ˆå™¨ Consoleï¼Œç™»å½•åæ‰§è¡Œï¼š

```javascript
// æµ‹è¯•è·å–ç”¨æˆ·èœå•
fetch('/api/v1/auth/user-menus/', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  }
})
.then(r => r.json())
.then(data => console.log('èœå•API:', data))
.catch(err => console.error('èœå•APIé”™è¯¯:', err))

// æµ‹è¯•ç³»ç»Ÿç»Ÿè®¡API
fetch('/api/v1/system/statistics/dashboard/', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  }
})
.then(r => r.json())
.then(data => console.log('ç³»ç»Ÿç»Ÿè®¡API:', data))
.catch(err => console.error('ç³»ç»Ÿç»Ÿè®¡APIé”™è¯¯:', err))
```

**è®°å½•è¾“å‡ºç»“æœ**ã€‚

---

## å¯èƒ½çš„åŸå› åˆ†æ

### åŸå› 1: getUserMenus() å¤±è´¥

**ç—‡çŠ¶**: ç™»å½•åç«‹å³æ˜¾ç¤ºé”™è¯¯

**åŸå› **: `/auth/user-menus/` API è¿”å› 403

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥åç«¯è¯¥APIçš„æƒé™è®¾ç½®

### åŸå› 2: ç³»ç»Ÿç»Ÿè®¡APIå¤±è´¥

**ç—‡çŠ¶**: è¿›å…¥ç³»ç»Ÿç®¡ç†é¡µé¢åæ˜¾ç¤ºé”™è¯¯

**åŸå› **: `/system/statistics/dashboard/` API è¿”å› 403

**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥è¯¥APIçš„æƒé™é…ç½®

### åŸå› 3: Tokenæœªæ­£ç¡®ä¼ é€’

**ç—‡çŠ¶**: æ‰€æœ‰éœ€è¦è®¤è¯çš„è¯·æ±‚éƒ½å¤±è´¥

**æ£€æŸ¥**: 
```javascript
// åœ¨Consoleä¸­æ‰§è¡Œ
console.log('Token:', localStorage.getItem('token'))
console.log('Tokenæ˜¯å¦å­˜åœ¨:', !!localStorage.getItem('token'))
```

### åŸå› 4: å‰ç«¯storeæœªæ­£ç¡®æ›´æ–°

**æ£€æŸ¥**:
```javascript
// åœ¨Consoleä¸­æ‰§è¡Œï¼ˆç™»å½•åï¼‰
// æ³¨æ„ï¼šç”±äºæ¨¡å—ç³»ç»Ÿé™åˆ¶ï¼Œè¿™ä¸ªå¯èƒ½æ— æ³•ç›´æ¥æ‰§è¡Œ
// ä½†å¯ä»¥åœ¨ç™»å½•æˆåŠŸåç«‹å³åœ¨ä»£ç ä¸­æ‰“å°
```

---

## ä¸´æ—¶è°ƒè¯•ä»£ç 

### åœ¨ Login.vue ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯

ä¿®æ”¹ `handleAdminLogin` å‡½æ•°ï¼Œæ·»åŠ æ›´å¤šæ—¥å¿—ï¼š

```javascript
const handleAdminLogin = async () => {
  try {
    adminLoading.value = true
    
    console.log('ğŸ”¹ å¼€å§‹ç®¡ç†å‘˜ç™»å½•...')
    
    const result = await userStore.login({
      username: 'admin',
      password: 'admin123'
    })
    
    console.log('ğŸ”¹ ç™»å½•ç»“æœ:', result)
    console.log('ğŸ”¹ ç”¨æˆ·ä¿¡æ¯:', result.user)
    console.log('ğŸ”¹ is_staff:', result.user?.is_staff)
    console.log('ğŸ”¹ is_superuser:', result.user?.is_superuser)
    console.log('ğŸ”¹ store.isAdmin:', userStore.isAdmin)
    
    if (result.success) {
      ElMessage.success('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼')
      console.log('ğŸ”¹ å‡†å¤‡è·³è½¬åˆ° /dashboard/system')
      await router.push('/dashboard/system')
      console.log('ğŸ”¹ è·³è½¬å®Œæˆ')
    } else {
      console.error('âŒ ç™»å½•å¤±è´¥:', result.error)
    }
  } catch (error) {
    console.error('âŒ ç™»å½•å¼‚å¸¸:', error)
    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response?.data)
    ElMessage.error('ç®¡ç†å‘˜ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ')
  } finally {
    adminLoading.value = false
  }
}
```

### åœ¨ user store çš„ getUserMenus ä¸­æ·»åŠ æ—¥å¿—

`frontend/src/stores/user.js`:

```javascript
const getUserMenus = async () => {
  try {
    console.log('ğŸ”¹ å¼€å§‹è·å–ç”¨æˆ·èœå•...')
    const response = await api.get('/auth/user-menus/')
    console.log('ğŸ”¹ èœå•æ•°æ®:', response.data)
    menus.value = response.data
    return response.data
  } catch (error) {
    console.error('âŒ è·å–ç”¨æˆ·èœå•å¤±è´¥:', error)
    console.error('âŒ çŠ¶æ€ç :', error.response?.status)
    console.error('âŒ é”™è¯¯è¯¦æƒ…:', error.response?.data)
    return []
  }
}
```

---

## å¿«é€Ÿæµ‹è¯•è„šæœ¬

### åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œï¼ˆç™»å½•åï¼‰

```javascript
// å®Œæ•´è¯Šæ–­è„šæœ¬
(async function() {
  console.log('===== æƒé™è¯Šæ–­å¼€å§‹ =====')
  
  // 1. æ£€æŸ¥æœ¬åœ°å­˜å‚¨
  const token = localStorage.getItem('token')
  console.log('1ï¸âƒ£ Tokenå­˜åœ¨:', !!token)
  console.log('   Tokené•¿åº¦:', token?.length)
  
  // 2. æµ‹è¯•ç”¨æˆ·èœå•API
  console.log('\n2ï¸âƒ£ æµ‹è¯•ç”¨æˆ·èœå•API...')
  try {
    const menuRes = await fetch('/api/v1/auth/user-menus/', {
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      }
    })
    console.log('   çŠ¶æ€ç :', menuRes.status)
    const menuData = await menuRes.json()
    console.log('   å“åº”:', menuData)
  } catch (err) {
    console.error('   é”™è¯¯:', err)
  }
  
  // 3. æµ‹è¯•ç³»ç»Ÿç»Ÿè®¡API
  console.log('\n3ï¸âƒ£ æµ‹è¯•ç³»ç»Ÿç»Ÿè®¡API...')
  try {
    const statsRes = await fetch('/api/v1/system/statistics/dashboard/', {
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      }
    })
    console.log('   çŠ¶æ€ç :', statsRes.status)
    if (statsRes.ok) {
      const statsData = await statsRes.json()
      console.log('   å“åº”:', statsData)
    } else {
      const errorData = await statsRes.text()
      console.error('   é”™è¯¯å“åº”:', errorData)
    }
  } catch (err) {
    console.error('   é”™è¯¯:', err)
  }
  
  // 4. æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API
  console.log('\n4ï¸âƒ£ æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API...')
  try {
    const profileRes = await fetch('/api/v1/auth/profile/', {
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      }
    })
    console.log('   çŠ¶æ€ç :', profileRes.status)
    const profileData = await profileRes.json()
    console.log('   ç”¨æˆ·ä¿¡æ¯:', profileData)
    console.log('   is_staff:', profileData.is_staff)
    console.log('   is_superuser:', profileData.is_superuser)
  } catch (err) {
    console.error('   é”™è¯¯:', err)
  }
  
  console.log('\n===== æƒé™è¯Šæ–­ç»“æŸ =====')
})()
```

---

## ä¸‹ä¸€æ­¥

### è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. âœ… è¿è¡Œä¸Šé¢çš„"å®Œæ•´è¯Šæ–­è„šæœ¬"
2. âœ… å¤åˆ¶æ‰€æœ‰Consoleè¾“å‡º
3. âœ… å‘Šè¯‰æˆ‘å“ªä¸ªAPIè¿”å›äº†403
4. âœ… æä¾›é‚£ä¸ª403è¯·æ±‚çš„Responseå†…å®¹

### ç„¶åæˆ‘ä¼šï¼š

æ ¹æ®å…·ä½“çš„403é”™è¯¯ï¼Œä¿®æ”¹ç›¸åº”çš„åç«¯æƒé™é…ç½®æˆ–å‰ç«¯è¯·æ±‚é€»è¾‘ã€‚

---

**ç­‰å¾…æ‚¨çš„åé¦ˆï¼** è¯·æä¾›ï¼š
- è¯Šæ–­è„šæœ¬çš„å®Œæ•´è¾“å‡º
- å“ªä¸ªAPIè¿”å›403
- 403å“åº”çš„è¯¦ç»†å†…å®¹


