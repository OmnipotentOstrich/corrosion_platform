import{r as u,C as z,c as l,o as i,d as t,e as I,w as N,Q as V,L as a,ax as B,x as f,S as y,H as k,I as g,ak as L,aI as M,N as T,an as _,B as c}from"./index-B_YfpHek.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const S={class:"info-detail"},$={class:"detail-header"},F={class:"breadcrumb"},H={class:"info-meta"},Q={class:"meta-info"},R={class:"author"},U={class:"time"},j={class:"category"},q={class:"stats"},A={class:"actions"},G={key:0},J={key:1},K={class:"detail-content"},O={class:"content-body"},P={class:"summary"},W={class:"content-text"},X={key:0,class:"tags"},Y={class:"tag-list"},Z={class:"comments-section"},tt={class:"comment-form"},st={class:"comments-list"},et={key:0,class:"no-comments"},ot={class:"comment-header"},at={class:"comment-author"},nt={class:"comment-time"},lt={class:"comment-content"},it={__name:"Detail",setup(ct){const d=T(),s=u({title:"",summary:"",content:"",author_name:"",published_at:"",view_count:0,like_count:0,comment_count:0,is_liked:!1,post_type_display:"",tags:""}),r=u(""),m=u([]),p=u(!1),b=async()=>{try{p.value=!0;const e=d.params.id,o=await _.get(`/info-plaza/posts/${e}/`);s.value=o.data,v()}catch(e){console.error("加载信息详情失败:",e),c.error("加载信息详情失败")}finally{p.value=!1}},v=async()=>{try{const e=await _.get("/info-plaza/comments/",{params:{post:d.params.id}});m.value=e.data.results||e.data}catch(e){console.error("加载评论失败:",e)}},w=async()=>{try{(await _.post(`/info-plaza/posts/${d.params.id}/like/`)).data.liked?(s.value.is_liked=!0,s.value.like_count+=1,c.success("点赞成功")):(s.value.is_liked=!1,s.value.like_count-=1,c.success("已取消点赞"))}catch(e){console.error("点赞失败:",e),c.error("操作失败，请重试")}},C=()=>{const e=window.location.href;navigator.clipboard.writeText(e).then(()=>{c.success("链接已复制到剪贴板")}).catch(()=>{c.error("复制失败，请手动复制")})},x=async()=>{if(!r.value.trim()){c.warning("请输入评论内容");return}try{await _.post("/info-plaza/comments/",{post:d.params.id,content:r.value}),c.success("评论发表成功"),r.value="",s.value.comment_count+=1,v()}catch(e){console.error("发表评论失败:",e),c.error("发表评论失败，请重试")}},h=e=>e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return z(()=>{b()}),(e,o)=>{const D=V("router-link");return i(),l("div",S,[t("div",$,[t("div",F,[I(D,{to:"/dashboard/info-plaza"},{default:N(()=>[...o[1]||(o[1]=[f("信息广场",-1)])]),_:1}),o[2]||(o[2]=t("span",{class:"separator"},">",-1)),o[3]||(o[3]=t("span",null,"信息详情",-1))]),t("div",H,[t("h1",null,a(s.value.title),1),t("div",Q,[t("span",R,"发布者: "+a(s.value.author_name),1),t("span",U,"发布时间: "+a(h(s.value.published_at)),1),t("span",j,a(s.value.post_type_display),1)]),t("div",q,[t("span",null,"浏览: "+a(s.value.view_count||0),1),t("span",null,"点赞: "+a(s.value.like_count||0),1),t("span",null,"评论: "+a(s.value.comment_count||0),1)])]),t("div",A,[t("button",{class:B(["btn",s.value.is_liked?"btn-liked":"btn-outline"]),onClick:w},[s.value.is_liked?(i(),l("span",G,"❤️ 已点赞")):(i(),l("span",J,"🤍 点赞")),f(" ("+a(s.value.like_count)+") ",1)],2),t("button",{class:"btn btn-primary",onClick:C}," 分享 ")])]),t("div",K,[t("div",O,[o[5]||(o[5]=t("h3",null,"摘要",-1)),t("p",P,a(s.value.summary),1),o[6]||(o[6]=t("h3",null,"详细内容",-1)),t("div",W,a(s.value.content),1),s.value.tags?(i(),l("div",X,[o[4]||(o[4]=t("h4",null,"标签",-1)),t("div",Y,[(i(!0),l(k,null,g(s.value.tags,n=>(i(),l("span",{key:n,class:"tag"},a(n),1))),128))])])):y("",!0)]),t("div",Z,[t("h3",null,"评论 ("+a(s.value.comment_count)+")",1),t("div",tt,[L(t("textarea",{"onUpdate:modelValue":o[0]||(o[0]=n=>r.value=n),placeholder:"写下您的评论...",rows:"3"},null,512),[[M,r.value]]),t("button",{class:"btn btn-primary",onClick:x}," 发表评论 ")]),t("div",st,[m.value.length===0?(i(),l("div",et," 暂无评论，快来发表第一条评论吧！ ")):y("",!0),(i(!0),l(k,null,g(m.value,n=>(i(),l("div",{key:n.id,class:"comment"},[t("div",ot,[t("span",at,a(n.author_name),1),t("span",nt,a(h(n.created_at)),1)]),t("div",lt,a(n.content),1)]))),128))])])])])}}},ut=E(it,[["__scopeId","data-v-189d7828"]]);export{ut as default};
