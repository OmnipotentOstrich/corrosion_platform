/* empty css             *//* empty css                   *//* empty css                   *//* empty css                 *//* empty css                             *//* empty css                  *//* empty css                  *//* empty css               *//* empty css                  *//* empty css               */import{c,o as p,d as o,e as t,ak as F,w as a,aK as B,aI as q,aJ as I,al as L,H as E,I as C,a8 as D,an as y,B as f,i as Q,x as V,g as Y,J as k,S as R,am as N,aB as O,q as P,s as j,G as H,K as J,aL as K,aM as z,L as g,ax as G}from"./index-B_YfpHek.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={name:"EnterpriseEmployees",data(){return{searchQuery:"",departmentFilter:"",employees:[],loading:!1,showAddDialog:!1,adding:!1,enterprises:[],userType:"enterprise",addForm:{username:"",employee_id:"",first_name:"",email:"",phone:"",password:"",position:"",department:"",hire_date:"",salary:null,enterprise_id:null},addFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],employee_id:[{required:!0,message:"请输入工号",trigger:"blur"}],first_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],position:[{required:!0,message:"请选择职位",trigger:"change"}],department:[{required:!0,message:"请输入部门",trigger:"blur"}],hire_date:[{required:!0,message:"请选择入职日期",trigger:"change"}]}}},mounted(){this.loadEmployees(),this.loadEnterprises(),this.getUserType()},watch:{searchQuery(){this.loadEmployees()},departmentFilter(){this.loadEmployees()}},computed:{filteredEmployees(){return this.employees.filter(r=>{const e=r.username||r.first_name||r.last_name||"",h=r.employee_id||"",w=e.toLowerCase().includes(this.searchQuery.toLowerCase())||h.toLowerCase().includes(this.searchQuery.toLowerCase()),s=!this.departmentFilter||r.department===this.departmentFilter;return w&&s})}},methods:{async loadEmployees(){try{this.loading=!0;const r={};this.searchQuery&&(r.search=this.searchQuery),this.departmentFilter&&(r.department=this.departmentFilter);const e=await y.get("/enterprises/employees/",{params:r}).catch(()=>({data:[]}));this.employees=e.data.results||e.data}catch(r){console.error("加载员工列表失败:",r),this.employees=[]}finally{this.loading=!1}},async getUserType(){try{const r=await y.get("/auth/profile/");this.userType=r.data.user_type||"enterprise"}catch(r){console.error("获取用户类型失败:",r)}},async loadEnterprises(){if(this.userType==="admin")try{const r=await y.get("/enterprises/");this.enterprises=r.data.results||r.data}catch(r){console.error("加载企业列表失败:",r)}},generateSuggestions(){const r=Date.now().toString().slice(-6);Math.floor(Math.random()*1e3).toString().padStart(3,"0"),this.addForm.username=`emp_${r}`,this.addForm.employee_id=`EMP${r}`,this.addForm.email=`emp${r}@company.com`,this.addForm.phone=`138${r}`,this.addForm.password="Employee123",this.addForm.hire_date=new Date().toISOString().split("T")[0]},async submitAddEmployee(){try{await this.$refs.addFormRef.validate(),this.adding=!0;const r={...this.addForm};this.userType!=="admin"&&delete r.enterprise_id,await y.post("/enterprises/employees/",r),f.success("员工添加成功"),this.handleCloseDialog(),this.loadEmployees()}catch(r){if(console.error("添加员工失败:",r),r.response?.data){const e=r.response.data;if(typeof e=="object"){const h=Object.values(e)[0];f.error(Array.isArray(h)?h[0]:h)}else f.error(e)}else f.error("添加员工失败，请稍后重试")}finally{this.adding=!1}},handleCloseDialog(){this.showAddDialog=!1,this.resetAddForm()},resetAddForm(){this.addForm={username:"",employee_id:"",first_name:"",email:"",phone:"",password:"",position:"",department:"",hire_date:"",salary:null,enterprise_id:null},this.$refs.addFormRef&&this.$refs.addFormRef.clearValidate()},viewEmployee(r){D.alert(`
        <div style="text-align: left;">
          <h3>${r.name}</h3>
          <p><strong>工号：</strong>${r.employeeId}</p>
          <p><strong>部门：</strong>${r.department}</p>
          <p><strong>职位：</strong>${r.position}</p>
          <p><strong>入职日期：</strong>${r.hireDate}</p>
          <p><strong>状态：</strong>${r.statusText}</p>
        </div>
      `,"员工详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},async editEmployee(r){try{const{value:e}=await D.prompt(`编辑员工信息 - ${r.name}`,"编辑员工",{confirmButtonText:"保存",cancelButtonText:"取消",inputValue:r.name,inputPattern:/.+/,inputErrorMessage:"姓名不能为空"});await y.put(`/enterprises/employees/${r.id}/`,{...r,name:e}),f.success("员工信息已更新"),this.loadEmployees()}catch(e){e!=="cancel"&&(console.error("更新员工失败:",e),f.error("更新员工失败"))}}}},Z={class:"enterprise-employees"},$={class:"page-header"},ee={class:"header-actions"},te={class:"form-header"},le={class:"dialog-footer"},re={class:"filters"},se={class:"employees-table"},oe=["onClick"],ae=["onClick"];function ne(r,e,h,w,s,i){const b=Q,u=j,n=P,d=O,_=N,m=J,v=H,x=K,U=z,T=Y,M=B,S=L;return p(),c("div",Z,[o("div",$,[e[15]||(e[15]=o("h1",null,"员工管理",-1)),o("div",ee,[o("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=l=>s.showAddDialog=!0)}," 添加员工 ")])]),t(M,{modelValue:s.showAddDialog,"onUpdate:modelValue":e[12]||(e[12]=l=>s.showAddDialog=l),title:"添加员工",width:"600px","before-close":i.handleCloseDialog},{footer:a(()=>[o("div",le,[t(b,{onClick:i.handleCloseDialog},{default:a(()=>[...e[18]||(e[18]=[V("取消",-1)])]),_:1},8,["onClick"]),t(b,{type:"primary",onClick:i.submitAddEmployee,loading:s.adding},{default:a(()=>[V(g(s.adding?"添加中...":"确定添加"),1)]),_:1},8,["onClick","loading"])])]),default:a(()=>[o("div",te,[e[17]||(e[17]=o("h4",null,"填写员工信息",-1)),t(b,{type:"text",onClick:i.generateSuggestions,style:{color:"#409eff"}},{default:a(()=>[...e[16]||(e[16]=[V(" 生成建议信息 ",-1)])]),_:1},8,["onClick"])]),t(T,{ref:"addFormRef",model:s.addForm,rules:s.addFormRules,"label-width":"100px"},{default:a(()=>[t(_,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(n,{label:"用户名",prop:"username"},{default:a(()=>[t(u,{modelValue:s.addForm.username,"onUpdate:modelValue":e[1]||(e[1]=l=>s.addForm.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(n,{label:"工号",prop:"employee_id"},{default:a(()=>[t(u,{modelValue:s.addForm.employee_id,"onUpdate:modelValue":e[2]||(e[2]=l=>s.addForm.employee_id=l),placeholder:"请输入工号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(_,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(n,{label:"姓名",prop:"first_name"},{default:a(()=>[t(u,{modelValue:s.addForm.first_name,"onUpdate:modelValue":e[3]||(e[3]=l=>s.addForm.first_name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(n,{label:"邮箱",prop:"email"},{default:a(()=>[t(u,{modelValue:s.addForm.email,"onUpdate:modelValue":e[4]||(e[4]=l=>s.addForm.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(_,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(n,{label:"手机号",prop:"phone"},{default:a(()=>[t(u,{modelValue:s.addForm.phone,"onUpdate:modelValue":e[5]||(e[5]=l=>s.addForm.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(n,{label:"密码",prop:"password"},{default:a(()=>[t(u,{modelValue:s.addForm.password,"onUpdate:modelValue":e[6]||(e[6]=l=>s.addForm.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(_,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(n,{label:"职位",prop:"position"},{default:a(()=>[t(v,{modelValue:s.addForm.position,"onUpdate:modelValue":e[7]||(e[7]=l=>s.addForm.position=l),placeholder:"请选择职位",style:{width:"100%"}},{default:a(()=>[t(m,{label:"管理员",value:"admin"}),t(m,{label:"经理",value:"manager"}),t(m,{label:"工程师",value:"engineer"}),t(m,{label:"技术员",value:"technician"}),t(m,{label:"销售",value:"sales"}),t(m,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(n,{label:"部门",prop:"department"},{default:a(()=>[t(u,{modelValue:s.addForm.department,"onUpdate:modelValue":e[8]||(e[8]=l=>s.addForm.department=l),placeholder:"请输入部门"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(_,{gutter:20},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(n,{label:"入职日期",prop:"hire_date"},{default:a(()=>[t(x,{modelValue:s.addForm.hire_date,"onUpdate:modelValue":e[9]||(e[9]=l=>s.addForm.hire_date=l),type:"date",placeholder:"请选择入职日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(n,{label:"薪资",prop:"salary"},{default:a(()=>[t(U,{modelValue:s.addForm.salary,"onUpdate:modelValue":e[10]||(e[10]=l=>s.addForm.salary=l),placeholder:"请输入薪资",min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s.userType==="admin"?(p(),k(n,{key:0,label:"企业",prop:"enterprise_id"},{default:a(()=>[t(v,{modelValue:s.addForm.enterprise_id,"onUpdate:modelValue":e[11]||(e[11]=l=>s.addForm.enterprise_id=l),placeholder:"请选择企业",style:{width:"100%"}},{default:a(()=>[(p(!0),c(E,null,C(s.enterprises,l=>(p(),k(m,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"]),o("div",re,[F(o("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=l=>s.searchQuery=l),placeholder:"搜索员工...",class:"search-input"},null,512),[[q,s.searchQuery]]),F(o("select",{"onUpdate:modelValue":e[14]||(e[14]=l=>s.departmentFilter=l),class:"filter-select"},[...e[19]||(e[19]=[o("option",{value:""},"全部部门",-1),o("option",{value:"engineering"},"工程部",-1),o("option",{value:"management"},"管理部",-1),o("option",{value:"sales"},"销售部",-1)])],512),[[I,s.departmentFilter]])]),F((p(),c("div",se,[o("table",null,[e[20]||(e[20]=o("thead",null,[o("tr",null,[o("th",null,"姓名"),o("th",null,"工号"),o("th",null,"部门"),o("th",null,"职位"),o("th",null,"入职日期"),o("th",null,"状态"),o("th",null,"操作")])],-1)),o("tbody",null,[(p(!0),c(E,null,C(i.filteredEmployees,l=>(p(),c("tr",{key:l.id},[o("td",null,g(l.username||l.first_name+" "+l.last_name),1),o("td",null,g(l.employee_id),1),o("td",null,g(l.department),1),o("td",null,g(l.position_display||l.position),1),o("td",null,g(l.hire_date),1),o("td",null,[o("span",{class:G(["status",l.is_active?"active":"inactive"])},g(l.is_active?"在职":"离职"),3)]),o("td",null,[o("button",{class:"btn btn-sm btn-outline",onClick:A=>i.viewEmployee(l)}," 查看 ",8,oe),o("button",{class:"btn btn-sm btn-primary",onClick:A=>i.editEmployee(l)}," 编辑 ",8,ae)])]))),128))])])])),[[S,s.loading]])])}const Fe=W(X,[["render",ne],["__scopeId","data-v-e8e5b935"]]);export{Fe as default};
