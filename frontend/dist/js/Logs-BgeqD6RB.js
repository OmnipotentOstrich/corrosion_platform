/* empty css             *//* empty css                   */import{c as u,o as p,d as e,ak as r,aI as v,aJ as m,b as h,al as L,H as x,I as F,L as n,a8 as c,an as f,B as d,ax as b}from"./index-B_YfpHek.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={name:"SystemLogs",data(){return{searchQuery:"",levelFilter:"",moduleFilter:"",dateFilter:"",currentPage:1,pageSize:20,totalPages:1,logs:[],loading:!1}},mounted(){this.loadLogs()},watch:{searchQuery(){this.loadLogs()},levelFilter(){this.loadLogs()},moduleFilter(){this.loadLogs()},dateFilter(){this.loadLogs()},currentPage(){this.loadLogs()}},computed:{filteredLogs(){return this.logs}},methods:{getLevelText(s){return{info:"信息",warning:"警告",error:"错误",debug:"调试"}[s]||s},async loadLogs(){try{this.loading=!0;const s={page:this.currentPage,page_size:this.pageSize};this.searchQuery&&(s.search=this.searchQuery),this.levelFilter&&(s.level=this.levelFilter),this.moduleFilter&&(s.module=this.moduleFilter),this.dateFilter&&(s.date=this.dateFilter);const t=await f.get("/system/logs/",{params:s}),g=t.data.results||t.data||[];this.logs=g.map(l=>({id:l.id,timestamp:l.timestamp||l.created_at||"-",level:l.level||"info",levelText:this.getLevelText(l.level),module:l.module||"-",user:l.user||l.username||"-",action:l.action||l.message||"-",ip:l.ip_address||l.ip||"-",detail:l.detail||l.description||"-",...l})),t.data.count&&(this.totalPages=Math.ceil(t.data.count/this.pageSize))}catch(s){console.error("加载日志失败:",s),d.error("加载日志失败"),this.logs=[]}finally{this.loading=!1}},viewLogDetail(s){c.alert(`
        <div style="text-align: left;">
          <h3>日志详情</h3>
          <p><strong>时间：</strong>${s.timestamp}</p>
          <p><strong>级别：</strong>${s.levelText}</p>
          <p><strong>模块：</strong>${s.module}</p>
          <p><strong>用户：</strong>${s.user}</p>
          <p><strong>操作：</strong>${s.action}</p>
          <p><strong>IP地址：</strong>${s.ip}</p>
          <p><strong>详情：</strong>${s.detail}</p>
        </div>
      `,"日志详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},async exportLogs(){try{await c.confirm("确定要导出当前筛选的日志吗？","确认导出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const s=new URLSearchParams;this.levelFilter&&s.append("level",this.levelFilter),this.moduleFilter&&s.append("module",this.moduleFilter),this.dateFilter&&s.append("date",this.dateFilter),window.open(`/api/v1/system/logs/export/?${s.toString()}`,"_blank"),d.success("日志导出中，请稍候...")}catch(s){s!=="cancel"&&d.info("已取消导出")}},async clearLogs(){try{await c.confirm("确定要清空所有日志吗？此操作不可恢复！","警告",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"error"}),await f.delete("/system/logs/clear/"),d.success("日志已清空"),this.loadLogs()}catch(s){s!=="cancel"&&(console.error("清空日志失败:",s),d.error("清空日志失败"))}},previousPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++}}},_={class:"system-logs"},T={class:"page-header"},k={class:"header-actions"},B={class:"filters"},S={class:"logs-table"},M=["onClick"],C={class:"pagination"},Q=["disabled"],U={class:"page-info"},V=["disabled"];function z(s,t,g,l,i,o){const y=L;return p(),u("div",_,[e("div",T,[t[8]||(t[8]=e("h1",null,"系统日志",-1)),e("div",k,[e("button",{class:"btn btn-outline",onClick:t[0]||(t[0]=(...a)=>o.exportLogs&&o.exportLogs(...a))}," 导出日志 "),e("button",{class:"btn btn-danger",onClick:t[1]||(t[1]=(...a)=>o.clearLogs&&o.clearLogs(...a))}," 清空日志 ")])]),e("div",B,[r(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>i.searchQuery=a),placeholder:"搜索日志...",class:"search-input"},null,512),[[v,i.searchQuery]]),r(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>i.levelFilter=a),class:"filter-select"},[...t[9]||(t[9]=[h('<option value="" data-v-35a91dab>全部级别</option><option value="info" data-v-35a91dab>信息</option><option value="warning" data-v-35a91dab>警告</option><option value="error" data-v-35a91dab>错误</option><option value="debug" data-v-35a91dab>调试</option>',5)])],512),[[m,i.levelFilter]]),r(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>i.moduleFilter=a),class:"filter-select"},[...t[10]||(t[10]=[h('<option value="" data-v-35a91dab>全部模块</option><option value="auth" data-v-35a91dab>认证模块</option><option value="user" data-v-35a91dab>用户模块</option><option value="project" data-v-35a91dab>项目模块</option><option value="system" data-v-35a91dab>系统模块</option>',5)])],512),[[m,i.moduleFilter]]),r(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=a=>i.dateFilter=a),class:"date-input"},null,512),[[v,i.dateFilter]])]),r((p(),u("div",S,[e("table",null,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"时间"),e("th",null,"级别"),e("th",null,"模块"),e("th",null,"用户"),e("th",null,"操作"),e("th",null,"IP地址"),e("th",null,"详情")])],-1)),e("tbody",null,[(p(!0),u(x,null,F(o.filteredLogs,a=>(p(),u("tr",{key:a.id,class:b(a.level)},[e("td",null,n(a.timestamp),1),e("td",null,[e("span",{class:b(["log-level",a.level])},n(a.levelText),3)]),e("td",null,n(a.module),1),e("td",null,n(a.user),1),e("td",null,n(a.action),1),e("td",null,n(a.ip),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline",onClick:I=>o.viewLogDetail(a)}," 查看 ",8,M)])],2))),128))])])])),[[y,i.loading]]),e("div",C,[e("button",{class:"btn btn-outline",onClick:t[6]||(t[6]=(...a)=>o.previousPage&&o.previousPage(...a)),disabled:i.currentPage===1}," 上一页 ",8,Q),e("span",U," 第 "+n(i.currentPage)+" 页，共 "+n(i.totalPages)+" 页 ",1),e("button",{class:"btn btn-outline",onClick:t[7]||(t[7]=(...a)=>o.nextPage&&o.nextPage(...a)),disabled:i.currentPage===i.totalPages}," 下一页 ",8,V)])])}const j=P(w,[["render",z],["__scopeId","data-v-35a91dab"]]);export{j as default};
