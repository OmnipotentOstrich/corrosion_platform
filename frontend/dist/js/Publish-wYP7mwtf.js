import{c as d,o as u,d as o,f as b,ak as i,aI as p,aJ as g,b as v,H as c,I as h,L as y,B as m,a8 as x,an as f}from"./index-B_YfpHek.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={name:"InfoPublish",data(){return{form:{title:"",post_type:"",category:"",summary:"",content:"",tags:""},categories:[],tags:[],loading:!1,publishing:!1}},mounted(){this.loadCategories(),this.loadTags()},computed:{isFormValid(){return this.form.title&&this.form.post_type&&this.form.content}},methods:{async loadCategories(){try{const s=await f.get("/info-plaza/categories/");this.categories=s.data.results||s.data||[]}catch(s){console.error("加载分类失败:",s)}},async loadTags(){try{const s=await f.get("/info-plaza/tags/");this.tags=s.data.results||s.data||[]}catch(s){console.error("加载标签失败:",s)}},async publishInfo(){if(!this.isFormValid){m.warning("请填写必填字段");return}try{await x.confirm("确定要发布此信息吗？","确认发布",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),this.publishing=!0;const s={title:this.form.title,post_type:this.form.post_type,content:this.form.content,summary:this.form.summary||""};this.form.category&&(s.category=this.form.category),this.form.tags&&(s.tags=this.form.tags.trim());const t=await f.post("/info-plaza/posts/",s);m.success("信息发布成功！"),this.resetForm(),setTimeout(()=>{this.$router.push("/dashboard/info-plaza")},1e3)}catch(s){if(s!=="cancel"){console.error("发布信息失败:",s);let t="发布失败，请稍后重试";if(s.response?.data){const a=s.response.data;if(typeof a=="object"){const n=Object.values(a)[0];Array.isArray(n)?t=n[0]:typeof n=="string"&&(t=n)}else typeof a=="string"&&(t=a)}m.error(t)}}finally{this.publishing=!1}},resetForm(){this.form={title:"",post_type:"",category:"",summary:"",content:"",tags:""}}}},_={class:"info-publish"},F={class:"publish-form"},B={class:"form-group"},I={class:"form-group"},M={class:"form-group"},T=["value"],U={class:"form-group"},k={class:"form-group"},z={class:"form-group"},D={class:"form-actions"},E=["disabled"],S=["disabled"];function q(s,t,a,n,r,l){return u(),d("div",_,[t[16]||(t[16]=o("div",{class:"page-header"},[o("h1",null,"发布信息"),o("p",null,"分享您的技术经验、行业资讯或项目信息")],-1)),o("div",F,[o("form",{onSubmit:t[7]||(t[7]=b((...e)=>l.publishInfo&&l.publishInfo(...e),["prevent"]))},[o("div",B,[t[8]||(t[8]=o("label",{for:"title"},"标题 *",-1)),i(o("input",{type:"text",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>r.form.title=e),placeholder:"请输入信息标题",required:""},null,512),[[p,r.form.title]])]),o("div",I,[t[10]||(t[10]=o("label",{for:"post_type"},"信息类型 *",-1)),i(o("select",{id:"post_type","onUpdate:modelValue":t[1]||(t[1]=e=>r.form.post_type=e),required:""},[...t[9]||(t[9]=[v('<option value="" data-v-624894b5>请选择信息类型</option><option value="supply" data-v-624894b5>供应信息</option><option value="demand" data-v-624894b5>需求信息</option><option value="recruitment" data-v-624894b5>招聘信息</option><option value="tender" data-v-624894b5>招标信息</option><option value="technology" data-v-624894b5>技术文章</option><option value="news" data-v-624894b5>行业资讯</option><option value="other" data-v-624894b5>其他</option>',8)])],512),[[g,r.form.post_type]])]),o("div",M,[t[12]||(t[12]=o("label",{for:"category"},"分类",-1)),i(o("select",{id:"category","onUpdate:modelValue":t[2]||(t[2]=e=>r.form.category=e)},[t[11]||(t[11]=o("option",{value:""},"请选择分类（可选）",-1)),(u(!0),d(c,null,h(r.categories,e=>(u(),d("option",{key:e.id,value:e.id},y(e.name),9,T))),128))],512),[[g,r.form.category]])]),o("div",U,[t[13]||(t[13]=o("label",{for:"summary"},"摘要",-1)),i(o("textarea",{id:"summary","onUpdate:modelValue":t[3]||(t[3]=e=>r.form.summary=e),placeholder:"请输入信息摘要",rows:"3"},null,512),[[p,r.form.summary]])]),o("div",k,[t[14]||(t[14]=o("label",{for:"content"},"内容 *",-1)),i(o("textarea",{id:"content","onUpdate:modelValue":t[4]||(t[4]=e=>r.form.content=e),placeholder:"请输入详细信息内容",rows:"10",required:""},null,512),[[p,r.form.content]])]),o("div",z,[t[15]||(t[15]=o("label",{for:"tags"},"标签",-1)),i(o("input",{type:"text",id:"tags","onUpdate:modelValue":t[5]||(t[5]=e=>r.form.tags=e),placeholder:"请输入标签，用逗号分隔"},null,512),[[p,r.form.tags]])]),o("div",D,[o("button",{type:"button",class:"btn btn-outline",onClick:t[6]||(t[6]=(...e)=>l.resetForm&&l.resetForm(...e)),disabled:r.publishing}," 重置 ",8,E),o("button",{type:"submit",class:"btn btn-primary",disabled:!l.isFormValid||r.publishing},y(r.publishing?"发布中...":"发布信息"),9,S)])],32)])])}const A=V(w,[["render",q],["__scopeId","data-v-624894b5"]]);export{A as default};
