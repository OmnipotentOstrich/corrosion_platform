/* empty css             *//* empty css                   *//* empty css                   *//* empty css                 *//* empty css                             *//* empty css                  *//* empty css                  *//* empty css               *//* empty css                  */import{r as c,M as Q,N as R,C as W,c as f,o as m,d,ak as X,e as t,w as o,i as Z,s as ee,G as le,al as te,S as D,H as ae,I as oe,aK as se,an as T,B as u,aj as re,x as p,K as ne,L as v,aF as ie,J as de,g as ue,q as ce,aL as pe,a8 as k}from"./index-B_YfpHek.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"personal-tasks"},_e={class:"page-header"},fe={class:"header-actions"},ye={class:"filters"},ge={class:"tasks-list"},Ve={key:0,class:"empty-state"},be={class:"task-header"},we={class:"task-badges"},xe={class:"task-description"},Te={class:"task-meta"},he={key:0},Ce={class:"task-actions"},je={class:"dialog-footer"},Ee={__name:"Tasks",setup(De){const Y=R(),h=c(!1),C=c(!1),y=c(""),b=c(""),w=c(""),j=c([]),g=c(!1),E=c(null),i=c({title:"",description:"",priority:"medium",status:"pending",due_date:""}),F=l=>({high:"高",medium:"中",low:"低"})[l]||l,N=l=>({high:"danger",medium:"warning",low:"info"})[l]||"",S=l=>({pending:"待处理",in_progress:"进行中",completed:"已完成",cancelled:"已取消"})[l]||l,$=l=>({pending:"info",in_progress:"primary",completed:"success",cancelled:"danger"})[l]||"",B=l=>l?re(l).format("YYYY-MM-DD"):"-",M=Q(()=>{let l=j.value.filter(r=>{const s=!y.value||r.title?.toLowerCase().includes(y.value.toLowerCase())||r.description?.toLowerCase().includes(y.value.toLowerCase()),n=!b.value||r.status===b.value,_=!w.value||r.priority===w.value;return s&&n&&_});const e=Y.query.projectId;return e&&(l=l.filter(r=>r.project_id==e)),l}),x=async()=>{try{h.value=!0;const l=await T.get("/persons/tasks/"),e=l.data.results||l.data||[];j.value=e.map(s=>({id:s.id,title:s.title||"未命名任务",description:s.description||"",project:s.project_name||s.project||"",project_id:s.project_id||s.project,priority:s.priority||"medium",status:s.status||"pending",deadline:B(s.due_date||s.deadline),createdAt:B(s.created_at),...s}));const r=Y.query.projectName;r&&u.success(`已筛选项目"${r}"的任务`)}catch(l){console.error("加载任务列表失败:",l),u.error("加载任务列表失败"),j.value=[]}finally{h.value=!1}},I=()=>{u.info("创建任务功能开发中")},z=async l=>{try{await k.confirm("确认完成此任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),await T.post(`/persons/tasks/${l.id}/complete/`),u.success("任务已完成"),x()}catch(e){e!=="cancel"&&(console.error("完成任务失败:",e),u.error("操作失败"))}},P=l=>{E.value=l,i.value={title:l.title,description:l.description,priority:l.priority,status:l.status,due_date:l.due_date||l.deadline},g.value=!0},q=async()=>{if(!i.value.title){u.error("请填写任务标题");return}try{C.value=!0,await T.put(`/persons/tasks/${E.value.id}/`,i.value),u.success("任务更新成功"),g.value=!1,x()}catch(l){console.error("更新任务失败:",l),u.error("更新失败")}finally{C.value=!1}},A=()=>{g.value=!1,E.value=null},K=async l=>{try{await k.confirm("确认删除此任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await T.delete(`/persons/tasks/${l.id}/`),u.success("删除成功"),x()}catch(e){e!=="cancel"&&(console.error("删除任务失败:",e),u.error("删除失败"))}};return W(()=>{x()}),(l,e)=>{const r=Z,s=ee,n=ne,_=le,U=ie,V=ce,G=pe,H=ue,J=se,O=te;return m(),f("div",ve,[d("div",_e,[e[10]||(e[10]=d("h1",null,"我的任务",-1)),d("div",fe,[t(r,{type:"primary",onClick:I},{default:o(()=>[...e[9]||(e[9]=[p(" 创建任务 ",-1)])]),_:1})])]),d("div",ye,[t(s,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),placeholder:"搜索任务...",clearable:"",style:{"max-width":"300px"}},null,8,["modelValue"]),t(_,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value=a),placeholder:"全部状态",clearable:"",style:{width:"150px"}},{default:o(()=>[t(n,{label:"待处理",value:"pending"}),t(n,{label:"进行中",value:"in_progress"}),t(n,{label:"已完成",value:"completed"}),t(n,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),t(_,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),placeholder:"全部优先级",clearable:"",style:{width:"150px"}},{default:o(()=>[t(n,{label:"高",value:"high"}),t(n,{label:"中",value:"medium"}),t(n,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),X((m(),f("div",ge,[M.value.length===0?(m(),f("div",Ve,[...e[11]||(e[11]=[d("p",null,"暂无任务数据",-1)])])):D("",!0),(m(!0),f(ae,null,oe(M.value,a=>(m(),f("div",{key:a.id,class:"task-card"},[d("div",be,[d("h3",null,v(a.title),1),d("div",we,[t(U,{type:N(a.priority),size:"small"},{default:o(()=>[p(v(F(a.priority)),1)]),_:2},1032,["type"]),t(U,{type:$(a.status),size:"small"},{default:o(()=>[p(v(S(a.status)),1)]),_:2},1032,["type"])])]),d("p",xe,v(a.description||"暂无描述"),1),d("div",Te,[a.project?(m(),f("span",he,"项目: "+v(a.project),1)):D("",!0),d("span",null,"截止时间: "+v(a.deadline),1),d("span",null,"创建时间: "+v(a.createdAt),1)]),d("div",Ce,[a.status!=="completed"?(m(),de(r,{key:0,type:"success",size:"small",onClick:L=>z(a)},{default:o(()=>[...e[12]||(e[12]=[p(" 完成 ",-1)])]),_:1},8,["onClick"])):D("",!0),t(r,{size:"small",onClick:L=>P(a)},{default:o(()=>[...e[13]||(e[13]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(r,{type:"danger",size:"small",onClick:L=>K(a)},{default:o(()=>[...e[14]||(e[14]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])])]))),128))])),[[O,h.value]]),t(J,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=a=>g.value=a),title:"编辑任务",width:"600px","close-on-click-modal":!1},{footer:o(()=>[d("span",je,[t(r,{onClick:A},{default:o(()=>[...e[15]||(e[15]=[p("取消",-1)])]),_:1}),t(r,{type:"primary",loading:C.value,onClick:q},{default:o(()=>[...e[16]||(e[16]=[p("保存",-1)])]),_:1},8,["loading"])])]),default:o(()=>[t(H,{model:i.value,"label-width":"100px"},{default:o(()=>[t(V,{label:"任务标题"},{default:o(()=>[t(s,{modelValue:i.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.title=a),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),t(V,{label:"任务描述"},{default:o(()=>[t(s,{modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.description=a),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),t(V,{label:"优先级"},{default:o(()=>[t(_,{modelValue:i.value.priority,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.priority=a),placeholder:"请选择优先级"},{default:o(()=>[t(n,{label:"高",value:"high"}),t(n,{label:"中",value:"medium"}),t(n,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"状态"},{default:o(()=>[t(_,{modelValue:i.value.status,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.status=a),placeholder:"请选择状态"},{default:o(()=>[t(n,{label:"待处理",value:"pending"}),t(n,{label:"进行中",value:"in_progress"}),t(n,{label:"已完成",value:"completed"}),t(n,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"截止时间"},{default:o(()=>[t(G,{modelValue:i.value.due_date,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value.due_date=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ze=me(Ee,[["__scopeId","data-v-38074914"]]);export{ze as default};
