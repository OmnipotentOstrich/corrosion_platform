/* empty css             *//* empty css                   */import{c as i,o as u,d as t,ak as g,aI as y,aJ as v,b as f,al as U,S as x,H as P,I as C,L as l,a8 as p,an as m,B as d,ax as _}from"./index-B_YfpHek.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={name:"SystemUsers",data(){return{searchQuery:"",roleFilter:"",statusFilter:"",users:[],loading:!1,currentPage:1,pageSize:20,totalCount:0,totalPages:0,searchTimeout:null}},mounted(){this.loadUsers()},methods:{async loadUsers(){try{this.loading=!0;const s={page:this.currentPage,page_size:this.pageSize};this.searchQuery&&(s.search=this.searchQuery),this.statusFilter&&(s.is_active=this.statusFilter==="active");const r=(await m.get("/auth/users/",{params:s}).catch(()=>({data:{results:[],count:0,total_pages:0}}))).data;this.users=(r.results||r).map(c=>({...c,role_text:c.role_text||this.getRoleText(c.roles),status_text:c.status_text||this.getStatusText(c.is_active)})),this.totalCount=r.count||0,this.totalPages=r.total_pages||Math.ceil(this.totalCount/this.pageSize),this.currentPage>this.totalPages&&this.totalPages>0&&(this.currentPage=1,this.loadUsers())}catch(s){console.error("加载用户列表失败:",s),this.users=[],this.totalCount=0,this.totalPages=0}finally{this.loading=!1}},debouncedSearch(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.currentPage=1,this.loadUsers()},500)},goToPage(s){s>=1&&s<=this.totalPages&&(this.currentPage=s,this.loadUsers())},changePageSize(){this.currentPage=1,this.loadUsers()},getRoleClass(s){if(!s||s.length===0)return"user";const e=s[0].code;return{admin:"admin",enterprise_admin:"manager",enterprise_employee:"user",project_manager:"manager",personal_user:"user",technician:"user",engineer:"manager"}[e]||"user"},getRoleText(s){if(!s||s.length===0)return"普通用户";const e=s[0];return{admin:"管理员",enterprise_admin:"企业管理员",enterprise_employee:"企业员工",project_manager:"项目经理",quality_supervisor:"质量监督员",safety_manager:"安全管理员",material_manager:"材料管理员",personal_user:"个人用户",technician:"技术员",engineer:"工程师",construction_worker:"建筑工人",labor_worker:"劳务工人",industry_consultant:"行业顾问",industry_expert:"行业专家"}[e.code]||e.name},getStatusText(s){return s?"活跃":"已禁用"},async addUser(){try{const{value:s}=await p.prompt("请输入用户名","添加用户",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[a-zA-Z0-9_]{3,20}$/,inputErrorMessage:"用户名格式不正确（3-20个字符，仅支持字母、数字、下划线）"});await m.post("/auth/users/",{username:s,email:`${s}@example.com`,password:"default123"}),d.success(`用户 ${s} 添加成功`),this.loadUsers()}catch(s){s!=="cancel"&&(console.error("添加用户失败:",s),d.error("添加用户失败"))}},viewUser(s){p.alert(`
        <div style="text-align: left;">
          <h3>${s.username}</h3>
          <p><strong>邮箱：</strong>${s.email}</p>
          <p><strong>角色：</strong>${s.role_text}</p>
          <p><strong>状态：</strong>${s.status_text}</p>
          <p><strong>注册时间：</strong>${s.register_time}</p>
          <p><strong>最后登录：</strong>${s.last_login}</p>
        </div>
      `,"用户详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},editUser(s){p.prompt(`编辑用户 - ${s.username}`,"编辑用户",{confirmButtonText:"保存",cancelButtonText:"取消",inputValue:s.email,inputPattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,inputErrorMessage:"请输入正确的邮箱地址"}).then(async({value:e})=>{try{await m.patch(`/auth/users/${s.id}/`,{email:e}),d.success("用户信息已更新"),this.loadUsers()}catch(r){console.error("更新用户信息失败:",r),d.error("更新用户信息失败")}}).catch(()=>{d.info("已取消")})},async toggleUserStatus(s){const e=s.is_active?"禁用":"启用";try{await p.confirm(`确定要${e}用户 ${s.username} 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.patch(`/auth/users/${s.id}/status/`,{is_active:!s.is_active}),d.success(`用户已${e}`),this.loadUsers()}catch(r){r!=="cancel"&&(console.error("更新用户状态失败:",r),d.error("操作失败"))}}}},k={class:"system-users"},w={class:"page-header"},z={class:"header-actions"},B={class:"filters"},M={class:"users-table"},F={class:"user-info"},V={class:"avatar"},E=["onClick"],Q=["onClick"],I=["onClick"],L=["onClick"],R={key:0,class:"pagination"},j=["disabled"],N={class:"page-info"},A=["disabled"],D={class:"page-size-selector"};function H(s,e,r,c,n,o){const b=U;return u(),i("div",k,[t("div",w,[e[11]||(e[11]=t("h1",null,"用户管理",-1)),t("div",z,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...a)=>o.addUser&&o.addUser(...a))}," 添加用户 ")])]),t("div",B,[g(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>n.searchQuery=a),placeholder:"搜索用户...",class:"search-input",onInput:e[2]||(e[2]=(...a)=>o.debouncedSearch&&o.debouncedSearch(...a))},null,544),[[y,n.searchQuery]]),g(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>n.roleFilter=a),class:"filter-select",onChange:e[4]||(e[4]=(...a)=>o.loadUsers&&o.loadUsers(...a))},[...e[12]||(e[12]=[f('<option value="" data-v-7d499d34>全部角色</option><option value="admin" data-v-7d499d34>管理员</option><option value="enterprise_admin" data-v-7d499d34>企业管理员</option><option value="enterprise_employee" data-v-7d499d34>企业员工</option><option value="project_manager" data-v-7d499d34>项目经理</option><option value="personal_user" data-v-7d499d34>个人用户</option><option value="technician" data-v-7d499d34>技术员</option><option value="engineer" data-v-7d499d34>工程师</option>',8)])],544),[[v,n.roleFilter]]),g(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>n.statusFilter=a),class:"filter-select",onChange:e[6]||(e[6]=(...a)=>o.loadUsers&&o.loadUsers(...a))},[...e[13]||(e[13]=[t("option",{value:""},"全部状态",-1),t("option",{value:"active"},"活跃",-1),t("option",{value:"banned"},"已禁用",-1)])],544),[[v,n.statusFilter]])]),g((u(),i("div",M,[t("table",null,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"用户名"),t("th",null,"邮箱"),t("th",null,"角色"),t("th",null,"状态"),t("th",null,"注册时间"),t("th",null,"最后登录"),t("th",null,"操作")])],-1)),t("tbody",null,[(u(!0),i(P,null,C(n.users,a=>(u(),i("tr",{key:a.id},[t("td",null,[t("div",F,[t("div",V,l(a.username.charAt(0).toUpperCase()),1),t("span",null,l(a.username),1)])]),t("td",null,l(a.email),1),t("td",null,[t("span",{class:_(["role",o.getRoleClass(a.roles)])},l(a.role_text),3)]),t("td",null,[t("span",{class:_(["status",a.status])},l(a.status_text),3)]),t("td",null,l(a.register_time),1),t("td",null,l(a.last_login),1),t("td",null,[t("button",{class:"btn btn-sm btn-outline",onClick:h=>o.viewUser(a)}," 查看 ",8,E),t("button",{class:"btn btn-sm btn-primary",onClick:h=>o.editUser(a)}," 编辑 ",8,Q),a.is_active?(u(),i("button",{key:0,class:"btn btn-sm btn-danger",onClick:h=>o.toggleUserStatus(a)}," 禁用 ",8,I)):(u(),i("button",{key:1,class:"btn btn-sm btn-success",onClick:h=>o.toggleUserStatus(a)}," 启用 ",8,L))])]))),128))])]),n.totalPages>1?(u(),i("div",R,[t("button",{class:"btn btn-outline",disabled:n.currentPage===1,onClick:e[7]||(e[7]=a=>o.goToPage(n.currentPage-1))}," 上一页 ",8,j),t("span",N," 第 "+l(n.currentPage)+" 页，共 "+l(n.totalPages)+" 页 ",1),t("button",{class:"btn btn-outline",disabled:n.currentPage===n.totalPages,onClick:e[8]||(e[8]=a=>o.goToPage(n.currentPage+1))}," 下一页 ",8,A),t("div",D,[e[16]||(e[16]=t("label",null,"每页显示：",-1)),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>n.pageSize=a),onChange:e[10]||(e[10]=(...a)=>o.changePageSize&&o.changePageSize(...a))},[...e[15]||(e[15]=[t("option",{value:"10"},"10",-1),t("option",{value:"20"},"20",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)])],544),[[v,n.pageSize]])])])):x("",!0)])),[[b,n.loading]])])}const K=S(T,[["render",H],["__scopeId","data-v-7d499d34"]]);export{K as default};
