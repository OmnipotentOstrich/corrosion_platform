/* empty css             *//* empty css                   */import{c as l,o as r,d as o,ak as c,e as m,w as v,Q as b,aI as x,aJ as h,b as g,al as F,S as R,H as B,I as k,a8 as z,B as p,an as y,x as _,ax as C,L as n}from"./index-B_YfpHek.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={name:"ResourcesManagement",data(){return{searchQuery:"",typeFilter:"",categoryFilter:"",resources:[],loading:!1}},mounted(){this.loadResources()},watch:{searchQuery(){this.loadResources()},typeFilter(){this.loadResources()},categoryFilter(){this.loadResources()}},computed:{filteredResources(){return this.resources}},methods:{async loadResources(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.typeFilter&&(t.resource_type=this.typeFilter),this.categoryFilter&&(t.category=this.categoryFilter);const e=await y.get("/resources/",{params:t}),u=e.data.results||e.data||[];this.resources=u.map(a=>({id:a.id,name:a.name||a.title||"未命名资源",description:a.description||"暂无描述",type:a.resource_type||a.type||"document",category:this.getCategoryText(a.category),size:this.formatFileSize(a.file_size||a.size),downloads:a.download_count||a.downloads||0,uploadTime:this.formatDate(a.created_at||a.upload_time),downloadUrl:a.file||a.file_url||a.download_url,...a}))}catch(t){console.error("加载资源列表失败:",t),p.error("加载资源列表失败，请稍后重试"),this.resources=[]}finally{this.loading=!1}},getCategoryText(t){return{technical:"技术资料",training:"培训材料",standard:"标准规范",tool:"工具软件"}[t]||t||"其他"},formatFileSize(t){return t?t<1024?t+"B":t<1024*1024?(t/1024).toFixed(1)+"KB":t<1024*1024*1024?(t/(1024*1024)).toFixed(1)+"MB":(t/(1024*1024*1024)).toFixed(1)+"GB":"未知"},formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"-"},getResourceIcon(t){return{document:"fas fa-file-alt",image:"fas fa-image",video:"fas fa-video",software:"fas fa-download",template:"fas fa-file-code"}[t]||"fas fa-file"},async downloadResource(t){try{if(await z.confirm(`确定要下载 ${t.name} 吗？`,"确认下载",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),t.downloadUrl){window.open(t.downloadUrl,"_blank"),p.success(`开始下载: ${t.name}`);try{await y.post(`/resources/${t.id}/download/`),t.downloads++}catch(e){console.error("记录下载失败:",e)}}else p.warning("该资源暂无下载链接")}catch(e){e!=="cancel"&&(console.error("下载资源失败:",e),p.error("下载失败，请稍后重试"))}}}},V={class:"resources-management"},Q={class:"page-header"},D={class:"header-actions"},N={class:"filters"},S={class:"resources-grid"},U={key:0,class:"empty-state"},I={class:"resource-icon"},L={class:"resource-info"},E={class:"resource-description"},G={class:"resource-meta"},H={class:"type"},J={class:"category"},K={class:"size"},j={class:"resource-stats"},q={class:"resource-actions"},A=["onClick"];function O(t,e,u,a,i,d){const f=b("router-link"),w=F;return r(),l("div",V,[o("div",Q,[e[4]||(e[4]=o("h1",null,"资源管理",-1)),o("div",D,[m(f,{to:"/dashboard/resources/add",class:"btn btn-primary"},{default:v(()=>[...e[3]||(e[3]=[_(" 添加资源 ",-1)])]),_:1})])]),o("div",N,[c(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.searchQuery=s),placeholder:"搜索资源...",class:"search-input"},null,512),[[x,i.searchQuery]]),c(o("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.typeFilter=s),class:"filter-select"},[...e[5]||(e[5]=[g('<option value="" data-v-3b65fc4c>全部类型</option><option value="document" data-v-3b65fc4c>文档</option><option value="image" data-v-3b65fc4c>图片</option><option value="video" data-v-3b65fc4c>视频</option><option value="software" data-v-3b65fc4c>软件</option><option value="template" data-v-3b65fc4c>模板</option>',6)])],512),[[h,i.typeFilter]]),c(o("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.categoryFilter=s),class:"filter-select"},[...e[6]||(e[6]=[g('<option value="" data-v-3b65fc4c>全部分类</option><option value="technical" data-v-3b65fc4c>技术资料</option><option value="training" data-v-3b65fc4c>培训材料</option><option value="standard" data-v-3b65fc4c>标准规范</option><option value="tool" data-v-3b65fc4c>工具软件</option>',5)])],512),[[h,i.categoryFilter]])]),c((r(),l("div",S,[d.filteredResources.length===0?(r(),l("div",U,[...e[7]||(e[7]=[o("p",null,"暂无资源数据",-1)])])):R("",!0),(r(!0),l(B,null,k(d.filteredResources,s=>(r(),l("div",{key:s.id,class:"resource-card"},[o("div",I,[o("i",{class:C(d.getResourceIcon(s.type))},null,2)]),o("div",L,[o("h3",null,n(s.name),1),o("p",E,n(s.description),1),o("div",G,[o("span",H,n(s.type),1),o("span",J,n(s.category),1),o("span",K,n(s.size),1)]),o("div",j,[o("span",null,"下载: "+n(s.downloads),1),o("span",null,"上传: "+n(s.uploadTime),1)])]),o("div",q,[m(f,{to:`/dashboard/resources/detail/${s.id}`,class:"btn btn-sm btn-outline"},{default:v(()=>[...e[8]||(e[8]=[_(" 查看详情 ",-1)])]),_:1},8,["to"]),o("button",{class:"btn btn-sm btn-primary",onClick:P=>d.downloadResource(s)}," 下载 ",8,A)])]))),128))])),[[w,i.loading]])])}const $=M(T,[["render",O],["__scopeId","data-v-3b65fc4c"]]);export{$ as default};
