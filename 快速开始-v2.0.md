# å¿«é€Ÿå¼€å§‹æŒ‡å— - v2.0

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

é˜²è…ä¿æ¸©æ™ºèƒ½æ•°å­—å¹³å° v2.0 å·²æˆåŠŸå®Œå–„ç»„ç»‡æ¶æ„å±‚å’Œç³»ç»Ÿé…ç½®å±‚åŠŸèƒ½ï¼Œæä¾›ä¼ä¸šçº§çš„ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€ç³»ç»Ÿç›‘æ§å’Œç®¡ç†èƒ½åŠ›ã€‚

## âœ… å½“å‰çŠ¶æ€

- âœ… æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆ13ä¸ªæ–°å¢ + 4ä¸ªå¢å¼ºï¼‰
- âœ… è¿ç§»å·²åº”ç”¨
- âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… APIæ¥å£å·²å°±ç»ªï¼ˆ50+ æ–°å¢ï¼‰

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- Python 3.8+
- MySQL 5.7+
- Node.js 16+
- npm æˆ– yarn

### 2. åç«¯å¯åŠ¨

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®æ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰é…ç½®ï¼‰
# ç¼–è¾‘ config/settings.py æˆ–åˆ›å»º .env æ–‡ä»¶

# å¯åŠ¨æœåŠ¡
python manage.py runserver
```

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨

### 3. å‰ç«¯å¯åŠ¨

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

å‰ç«¯æœåŠ¡å°†åœ¨ `http://localhost:5173` å¯åŠ¨

## ğŸ“Š åŠŸèƒ½éªŒè¯

### 1. æµ‹è¯•æ–°åŠŸèƒ½

```bash
# è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•
python test_enhanced_features.py
```

é¢„æœŸè¾“å‡ºï¼š
```
=== æµ‹è¯•æ€»ç»“ ===
âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•å®Œæˆï¼
âœ… åˆ›å»º/éªŒè¯äº† 25 ä¸ªç”¨æˆ·
âœ… åˆ›å»º/éªŒè¯äº† 14 ä¸ªè§’è‰²
âœ… åˆ›å»º/éªŒè¯äº† 48 ä¸ªæƒé™
âœ… åˆ›å»º/éªŒè¯äº† 21 ä¸ªèœå•
âœ… åˆ›å»º/éªŒè¯äº† 8 ä¸ªç³»ç»Ÿé…ç½®
âœ… åˆ›å»º/éªŒè¯äº† 1 ä¸ªå®‰å…¨æ—¥å¿—
âœ… åˆ›å»º/éªŒè¯äº† 1 ä¸ªåˆ†ææ•°æ®
âœ… åˆ›å»º/éªŒè¯äº† 1 ä¸ªç»´æŠ¤è®¡åˆ’
âœ… åˆ›å»º/éªŒè¯äº† 1 ä¸ªå¤‡ä»½è®°å½•

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### 2. è®¿é—®ç®¡ç†åå°

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8000/admin`
2. ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ç™»å½•
3. æŸ¥çœ‹æ–°å¢çš„æ•°æ®æ¨¡å‹ï¼š
   - ç”¨æˆ·èµ„æ–™ (User Profiles)
   - ç”¨æˆ·ä¼šè¯ (User Sessions)
   - ç”¨æˆ·æ´»åŠ¨æ—¥å¿— (User Activity Logs)
   - æƒé™ç»„ (Permission Groups)
   - è§’è‰²æƒé™å®¡è®¡ (Role Permission Audits)
   - ç”¨æˆ·æƒé™è¦†ç›– (User Permission Overrides)
   - ç³»ç»Ÿå®‰å…¨æ—¥å¿— (System Security Logs)
   - ç³»ç»Ÿé¡µé¢é…ç½® (System Page Configs)
   - ç³»ç»Ÿåˆ†ææ•°æ® (System Analytics)
   - ç³»ç»Ÿç»´æŠ¤è®¡åˆ’ (System Maintenance)

### 3. APIæ¥å£æµ‹è¯•

#### è·å–ç”¨æˆ·èµ„æ–™
```bash
curl -X GET http://localhost:8000/api/users/profile/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### è·å–å®‰å…¨æ—¥å¿—
```bash
curl -X GET http://localhost:8000/api/system/security/security-logs/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### è·å–ç³»ç»Ÿæ€§èƒ½ç›‘æ§
```bash
curl -X GET http://localhost:8000/api/system/monitoring/performance/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ” æƒé™é…ç½®

### 1. åˆ›å»ºæƒé™ç»„

```python
from apps.users.models import PermissionGroup

# åˆ›å»ºç”¨æˆ·ç®¡ç†æƒé™ç»„
user_mgmt_group = PermissionGroup.objects.create(
    name='ç”¨æˆ·ç®¡ç†æƒé™ç»„',
    code='user_management_group',
    description='ç”¨æˆ·ç®¡ç†ç›¸å…³æƒé™',
    module='users',
    sort_order=1,
    is_active=True
)
```

### 2. åˆ†é…è§’è‰²æƒé™

```python
from apps.users.models import Role, Permission, RolePermission

role = Role.objects.get(code='admin')
permission = Permission.objects.get(code='users.view_userprofile')

RolePermission.objects.create(
    role=role,
    permission=permission
)
```

### 3. è®¾ç½®ç”¨æˆ·æƒé™è¦†ç›–

```python
from apps.users.models import User, Permission, UserPermissionOverride
from django.utils import timezone
from datetime import timedelta

user = User.objects.get(username='specific_user')
permission = Permission.objects.get(code='system.create_backup')

# ä¸´æ—¶æˆäºˆæƒé™ï¼ˆ7å¤©åè¿‡æœŸï¼‰
UserPermissionOverride.objects.create(
    user=user,
    permission=permission,
    is_granted=True,
    reason='ä¸´æ—¶éœ€è¦æ‰§è¡Œå¤‡ä»½æ“ä½œ',
    granted_by=admin_user,
    expire_at=timezone.now() + timedelta(days=7),
    is_active=True
)
```

## ğŸ“ˆ æ•°æ®åˆ†æ

### 1. è®°å½•ç”¨æˆ·è¡Œä¸º

```python
from apps.users.models import UserActivityLog

UserActivityLog.objects.create(
    user=user,
    action='create_post',
    description='å‘å¸ƒäº†ä¸€æ¡ä¿¡æ¯',
    ip_address='192.168.1.100',
    user_agent='Mozilla/5.0...',
    request_path='/api/info-plaza/posts/'
)
```

### 2. åˆ›å»ºåˆ†ææ•°æ®

```python
from apps.system.models import SystemAnalytics
from django.utils import timezone

SystemAnalytics.objects.create(
    analytics_type='user_behavior',
    metric_name='daily_active_users',
    metric_value=150,
    dimension_data={'platform': 'web', 'device': 'desktop'},
    time_period='daily',
    analysis_date=timezone.now().date()
)
```

### 3. æŸ¥çœ‹åˆ†æä»ªè¡¨æ¿

è®¿é—®ï¼š`http://localhost:8000/api/system/analytics/analytics-dashboard/`

## ğŸ”’ å®‰å…¨ç›‘æ§

### 1. åˆ›å»ºå®‰å…¨äº‹ä»¶

```python
from apps.system.models import SystemSecurityLog

SystemSecurityLog.objects.create(
    security_type='login_failure',
    user=user,
    ip_address='192.168.1.100',
    user_agent='Mozilla/5.0...',
    description='è¿ç»­5æ¬¡ç™»å½•å¤±è´¥',
    risk_level='high'
)
```

### 2. æŸ¥çœ‹å®‰å…¨ä»ªè¡¨æ¿

è®¿é—®ï¼š`http://localhost:8000/api/system/security/security-dashboard/`

### 3. è§£å†³å®‰å…¨äº‹ä»¶

```bash
curl -X POST http://localhost:8000/api/system/security/security-events/1/resolve/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤

### 1. åˆ›å»ºç»´æŠ¤è®¡åˆ’

```python
from apps.system.models import SystemMaintenance
from django.utils import timezone
from datetime import timedelta

SystemMaintenance.objects.create(
    maintenance_type='scheduled',
    title='æ•°æ®åº“ä¼˜åŒ–ç»´æŠ¤',
    description='å®šæœŸæ•°æ®åº“ä¼˜åŒ–å’Œæ¸…ç†',
    status='planned',
    scheduled_start=timezone.now() + timedelta(days=1),
    scheduled_end=timezone.now() + timedelta(days=1, hours=2),
    created_by=admin_user
)
```

### 2. å¼€å§‹ç»´æŠ¤

```bash
curl -X POST http://localhost:8000/api/system/maintenance/maintenance/1/start/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 3. å®Œæˆç»´æŠ¤

```bash
curl -X POST http://localhost:8000/api/system/maintenance/maintenance/1/complete/ \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ’¾ æ•°æ®å¤‡ä»½

### 1. åˆ›å»ºå¤‡ä»½

```python
from apps.system.models import SystemBackup
from django.utils import timezone

SystemBackup.objects.create(
    backup_type='database',
    name=f'backup_{timezone.now().strftime("%Y%m%d_%H%M%S")}',
    description='å®šæ—¶å¤‡ä»½',
    status='pending',
    created_by=admin_user
)
```

### 2. æŸ¥çœ‹å¤‡ä»½çŠ¶æ€

è®¿é—®ï¼š`http://localhost:8000/api/system/monitoring/backup-status/`

## ğŸ“± é¡µé¢é…ç½®

### 1. åˆ›å»ºé¡µé¢é…ç½®

```python
from apps.system.models import SystemPageConfig

SystemPageConfig.objects.create(
    page_name='dashboard',
    page_type='dashboard',
    title='ä»ªè¡¨æ¿',
    description='ç³»ç»Ÿä»ªè¡¨æ¿é¡µé¢',
    keywords='dashboard,ä»ªè¡¨æ¿,ç»Ÿè®¡',
    layout_config={
        'columns': 3,
        'widgets': ['statistics', 'charts', 'notifications']
    },
    theme_config={
        'primary_color': '#409EFF',
        'theme': 'light'
    },
    is_active=True
)
```

### 2. æ›´æ–°é¡µé¢é…ç½®

```bash
curl -X PUT http://localhost:8000/api/system/pages/page-configs/1/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æ–°çš„ä»ªè¡¨æ¿æ ‡é¢˜",
    "theme_config": {
      "primary_color": "#67C23A",
      "theme": "dark"
    }
  }'
```

## ğŸ¯ å¸¸ç”¨æ“ä½œ

### 1. æŸ¥çœ‹ç”¨æˆ·ä¼šè¯

```python
from apps.users.models import UserSession

# è·å–æ´»è·ƒä¼šè¯
active_sessions = UserSession.objects.filter(is_active=True)

# è·å–ç‰¹å®šç”¨æˆ·çš„ä¼šè¯
user_sessions = UserSession.objects.filter(user=user)
```

### 2. æŸ¥çœ‹ç”¨æˆ·æ´»åŠ¨æ—¥å¿—

```python
from apps.users.models import UserActivityLog
from django.utils import timezone
from datetime import timedelta

# è·å–æœ€è¿‘7å¤©çš„æ´»åŠ¨
recent_activities = UserActivityLog.objects.filter(
    created_at__gte=timezone.now() - timedelta(days=7)
)

# è·å–ç‰¹å®šç±»å‹çš„æ´»åŠ¨
login_activities = UserActivityLog.objects.filter(action='login')
```

### 3. æŸ¥çœ‹æƒé™å®¡è®¡æ—¥å¿—

```python
from apps.users.models import RolePermissionAudit

# è·å–æƒé™æˆäºˆè®°å½•
grant_audits = RolePermissionAudit.objects.filter(action='grant')

# è·å–ç‰¹å®šè§’è‰²çš„å®¡è®¡è®°å½•
role_audits = RolePermissionAudit.objects.filter(role=role)
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šè¡¨ä¸å­˜åœ¨

å¦‚æœé‡åˆ° "Table doesn't exist" é”™è¯¯ï¼š

```bash
# è¿è¡Œè¡¨åˆ›å»ºè„šæœ¬
cd backend
python create_missing_tables.py
python create_system_tables.py
```

### é—®é¢˜2ï¼šè¿ç§»å†å²ä¸ä¸€è‡´

å¦‚æœé‡åˆ°è¿ç§»å†å²ä¸ä¸€è‡´é”™è¯¯ï¼š

```bash
# è¿è¡Œä¿®å¤è„šæœ¬
cd backend
python fix_migrations.py
```

### é—®é¢˜3ï¼šå­—æ®µä¸å­˜åœ¨

å¦‚æœé‡åˆ° "Unknown column" é”™è¯¯ï¼š

```bash
# è¿è¡Œä¿®å¤è„šæœ¬
cd backend
python fix_menus_table.py
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹æ–‡æ¡£ï¼š
- [åŠŸèƒ½å®Œå–„æ€»ç»“](./ç»„ç»‡æ¶æ„å±‚å’Œç³»ç»Ÿé…ç½®å±‚åŠŸèƒ½å®Œå–„æ€»ç»“.md)
- [æœ€ç»ˆæŠ¥å‘Š](./ç»„ç»‡æ¶æ„å±‚å’Œç³»ç»Ÿé…ç½®å±‚åŠŸèƒ½å®Œå–„-æœ€ç»ˆæŠ¥å‘Š.md)

## ğŸ‰ ä¸‹ä¸€æ­¥

1. **é…ç½®å‰ç«¯è·¯ç”±** - å°†æ–°å¢çš„APIæ¥å£é›†æˆåˆ°å‰ç«¯
2. **è‡ªå®šä¹‰æƒé™è§„åˆ™** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®æƒé™
3. **è®¾ç½®ç›‘æ§å‘Šè­¦** - é…ç½®å®‰å…¨äº‹ä»¶å’Œæ€§èƒ½å‘Šè­¦
4. **ä¼˜åŒ–æ•°æ®åˆ†æ** - æ ¹æ®å®é™…æ•°æ®è°ƒæ•´åˆ†æç»´åº¦
5. **åˆ¶å®šç»´æŠ¤è®¡åˆ’** - è®¾ç½®å®šæœŸç»´æŠ¤ä»»åŠ¡

---

**ç‰ˆæœ¬**: v2.0.0  
**æ›´æ–°æ—¶é—´**: 2024-10-22  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

