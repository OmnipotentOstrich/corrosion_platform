# 浏览器端接口测试指南

## 前言
本指南帮助你在浏览器中测试前后端接口对接情况，通过浏览器开发者工具监控所有API调用。

---

## 准备工作

### 1. 启动后端服务
```bash
cd backend
python manage.py runserver
```

访问 http://localhost:8000/swagger/ 确认后端API文档可访问

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

访问 http://localhost:5173/ 确认前端页面可访问

### 3. 打开浏览器开发者工具
- **Chrome/Edge**: 按 `F12` 或 `Ctrl+Shift+I`
- **Firefox**: 按 `F12`
- **Safari**: `Command+Option+I`

切换到 **Network (网络)** 标签页

---

## 测试流程

### 一、登录流程测试

#### 1. 访问登录页面
```
URL: http://localhost:5173/login
```

#### 2. 监控网络请求
在Network标签页中，点击"Clear"清空现有请求

#### 3. 测试管理员登录
1. 点击"系统管理员"一键登录按钮
2. 在Network标签中查看请求

**预期看到的请求:**

**请求 #1: 登录请求**
```
Request:
- Method: POST
- URL: http://localhost:8000/api/v1/auth/login/
- Request Headers:
  Content-Type: application/json
- Request Payload:
  {
    "username": "admin",
    "password": "admin123"
  }

Response (Status: 200):
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "user_type": "admin",
    "is_staff": true
  }
}
```

**请求 #2: 获取用户菜单**
```
Request:
- Method: GET
- URL: http://localhost:8000/api/v1/auth/user-menus/
- Request Headers:
  Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...

Response (Status: 200):
[
  {
    "id": 1,
    "name": "仪表板",
    "code": "dashboard",
    "url": "/dashboard",
    ...
  }
]
```

#### 4. 验证Token存储
在Console标签页中执行:
```javascript
console.log('Token:', localStorage.getItem('token'))
console.log('Refresh Token:', localStorage.getItem('refreshToken'))
```

✅ **通过条件:**
- 登录请求返回200状态码
- 响应包含access、refresh和user字段
- token已保存到localStorage
- 自动跳转到仪表板或系统管理页面

---

### 二、仪表板测试

#### 1. 访问仪表板
登录成功后应自动跳转，或手动访问:
```
URL: http://localhost:5173/dashboard
```

#### 2. 监控API请求

**预期看到的请求:**

```
1. GET /api/v1/dashboard/statistics/
   - 状态: 200
   - 返回: 统计数据 { posts, resources, projects, tasks }

2. GET /api/v1/dashboard/activities/
   - 状态: 200
   - 返回: 活动列表数组

3. GET /api/v1/dashboard/tasks/
   - 状态: 200
   - 返回: 任务列表数组

4. GET /api/v1/dashboard/notifications/
   - 状态: 200
   - 返回: 通知列表数组
```

✅ **通过条件:**
- 所有请求都包含Authorization header
- 所有请求返回200状态码
- 页面正确显示统计数据

---

### 三、企业模块测试

#### 1. 登录企业账号
```
用户名: enterprise
密码: enterprise123
```

#### 2. 访问企业项目管理
```
URL: http://localhost:5173/dashboard/enterprise/projects
```

**预期API请求:**
```
GET /api/v1/enterprises/projects/
- 状态: 200
- 返回: { count, next, previous, results: [...] }
```

#### 3. 测试创建项目
1. 点击"新建项目"按钮
2. 输入项目名称
3. 点击确定

**预期API请求:**
```
POST /api/v1/enterprises/projects/
- Request Payload: { name: "项目名称", description: "", status: "active" }
- 状态: 201
- 返回: 创建的项目对象
```

#### 4. 访问员工管理
```
URL: http://localhost:5173/dashboard/enterprise/employees
```

**预期API请求:**
```
1. GET /api/v1/enterprises/
   - 获取企业列表

2. GET /api/v1/enterprises/employees/
   - 获取员工列表
```

#### 5. 测试添加员工
1. 点击"添加员工"按钮

**预期API请求:**
```
1. GET /api/v1/enterprises/
   - 获取企业列表用于选择

2. POST /api/v1/enterprises/employees/
   - Request Payload: 
     {
       "enterprise_id": 1,
       "username": "emp_xxxxx",
       "email": "emp_xxxxx@company.com",
       "phone": "138xxxxxx",
       "password": "Employee123",
       ...
     }
   - 状态: 201
```

✅ **通过条件:**
- 能正常获取项目和员工列表
- 能成功创建项目
- 能成功添加员工
- 所有操作有正确的成功/失败提示

---

### 四、个人模块测试

#### 1. 登录个人账号
```
用户名: user
密码: user123
```

#### 2. 访问个人中心
```
URL: http://localhost:5173/dashboard/personal
```

**预期API请求:**
```
GET /api/v1/persons/statistics/
- 状态: 200
- 返回: { ongoing_projects, pending_tasks, completed_tasks, completion_rate }
```

#### 3. 访问我的项目
```
URL: http://localhost:5173/dashboard/personal/projects
```

**预期API请求:**
```
GET /api/v1/persons/projects/
- 状态: 200
- 返回: 项目列表
```

#### 4. 访问我的任务
```
URL: http://localhost:5173/dashboard/personal/tasks
```

**预期API请求:**
```
GET /api/v1/persons/tasks/
- 状态: 200
- 返回: 任务列表
```

#### 5. 测试完成任务
1. 找到一个未完成的任务
2. 点击"完成"按钮
3. 确认操作

**预期API请求:**
```
POST /api/v1/persons/tasks/{task_id}/complete/
- 状态: 200 或 204
```

#### 6. 测试编辑任务
1. 点击任务的"编辑"按钮
2. 修改任务信息
3. 保存

**预期API请求:**
```
PUT /api/v1/persons/tasks/{task_id}/
- Request Payload: { title, description, priority, status, due_date }
- 状态: 200
```

✅ **通过条件:**
- 能正常获取个人统计、项目和任务
- 能成功完成、编辑、删除任务
- 任务状态变化正确反映

---

### 五、信息广场测试

#### 1. 访问信息广场
```
URL: http://localhost:5173/dashboard/info-plaza
```

**预期API请求:**
```
GET /api/v1/info-plaza/posts/?ordering=-published_at
- 状态: 200
- 返回: { count, results: [...] }
```

#### 2. 测试搜索功能
在搜索框输入关键词

**预期API请求:**
```
GET /api/v1/info-plaza/posts/?ordering=-published_at&search=关键词
```

#### 3. 测试筛选功能
选择信息类型（如"供应信息"）

**预期API请求:**
```
GET /api/v1/info-plaza/posts/?ordering=-published_at&post_type=supply
```

#### 4. 测试排序功能
选择不同的排序方式

**预期API请求:**
```
# 最受欢迎
GET /api/v1/info-plaza/posts/?ordering=-like_count

# 最多浏览
GET /api/v1/info-plaza/posts/?ordering=-view_count
```

#### 5. 测试点赞功能
点击某条信息的"点赞"按钮

**预期API请求:**
```
POST /api/v1/info-plaza/posts/{post_id}/like/
- 状态: 200
- 返回: { liked: true, like_count: 10 }
```

再次点击应取消点赞:
```
POST /api/v1/info-plaza/posts/{post_id}/like/
- 返回: { liked: false, like_count: 9 }
```

✅ **通过条件:**
- 信息列表正常加载
- 搜索、筛选、排序功能正常工作
- 点赞/取消点赞功能正常
- 点赞数实时更新

---

### 六、系统管理测试 (需要管理员权限)

#### 1. 用管理员账号登录
```
用户名: admin
密码: admin123
```

#### 2. 访问用户管理
```
URL: http://localhost:5173/dashboard/system/users
```

**预期API请求:**
```
GET /api/v1/auth/users/
- 状态: 200
- 返回: { count, results: [...] }
```

#### 3. 测试用户搜索
在搜索框输入用户名

**预期API请求:**
```
GET /api/v1/auth/users/?search=admin
```

#### 4. 测试禁用/启用用户
点击用户的"禁用"或"启用"按钮

**预期API请求:**
```
PATCH /api/v1/auth/users/{user_id}/
- Request Payload: { is_active: false } 或 { is_active: true }
- 状态: 200
```

✅ **通过条件:**
- 能正常获取用户列表
- 搜索功能正常
- 能成功禁用/启用用户

---

## 常见问题排查

### 问题1: 请求返回401 Unauthorized

**原因:** Token无效或过期

**检查:**
1. 在Console中检查token:
   ```javascript
   localStorage.getItem('token')
   ```
2. 检查Network中的请求头是否包含Authorization

**解决:**
1. 重新登录
2. 检查api/index.js中的拦截器配置

---

### 问题2: 请求返回403 Forbidden

**原因:** 用户没有权限访问该资源

**检查:**
1. 确认使用正确的用户类型
   - 系统管理功能需要管理员账号
   - 企业功能需要企业账号
2. 检查用户的角色和权限

**解决:**
1. 使用正确权限的账号
2. 检查后端权限配置

---

### 问题3: 请求返回404 Not Found

**原因:** API端点不存在

**检查:**
1. 确认后端服务正在运行
2. 检查URL是否正确
3. 访问 http://localhost:8000/swagger/ 查看可用的API

**解决:**
1. 确认后端URL配置正确
2. 检查前端baseURL配置 (frontend/src/api/index.js)

---

### 问题4: 请求返回500 Internal Server Error

**原因:** 后端服务器错误

**检查:**
1. 查看后端控制台的错误日志
2. 检查数据库连接是否正常
3. 检查请求数据格式是否正确

**解决:**
1. 修复后端代码错误
2. 检查数据库迁移是否完成
3. 检查必需的环境变量

---

### 问题5: Network中看不到请求

**原因:** 前端代码没有执行或JavaScript错误

**检查:**
1. 在Console标签页查看是否有JavaScript错误
2. 检查页面是否正常渲染
3. 检查Vue组件是否正确加载

**解决:**
1. 修复JavaScript错误
2. 检查Vue组件的生命周期钩子
3. 确认axios配置正确

---

## 使用Console进行手动测试

### 1. 测试登录
```javascript
fetch('http://localhost:8000/api/v1/auth/login/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username: 'admin', password: 'admin123' })
})
.then(r => r.json())
.then(console.log)
```

### 2. 测试带Token的请求
```javascript
const token = localStorage.getItem('token')

fetch('http://localhost:8000/api/v1/auth/profile/', {
  headers: { 'Authorization': `Bearer ${token}` }
})
.then(r => r.json())
.then(console.log)
```

### 3. 测试POST请求
```javascript
const token = localStorage.getItem('token')

fetch('http://localhost:8000/api/v1/enterprises/projects/', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    name: '测试项目',
    description: '这是一个测试项目',
    status: 'active'
  })
})
.then(r => r.json())
.then(console.log)
```

---

## 自动化测试脚本

在浏览器Console中运行以下脚本来自动测试所有API:

```javascript
async function testAllAPIs() {
  const BASE_URL = 'http://localhost:8000/api/v1'
  
  // 1. 登录
  console.log('1. 测试登录...')
  const loginResponse = await fetch(`${BASE_URL}/auth/login/`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: 'admin', password: 'admin123' })
  })
  const loginData = await loginResponse.json()
  console.log('✓ 登录成功', loginData)
  
  const token = loginData.access
  const authHeader = { 'Authorization': `Bearer ${token}` }
  
  // 2. 测试用户信息
  console.log('\n2. 测试用户信息...')
  const profileResponse = await fetch(`${BASE_URL}/auth/profile/`, {
    headers: authHeader
  })
  const profileData = await profileResponse.json()
  console.log('✓ 用户信息', profileData)
  
  // 3. 测试仪表板
  console.log('\n3. 测试仪表板...')
  const dashboardTests = [
    'dashboard/statistics/',
    'dashboard/activities/',
    'dashboard/tasks/',
    'dashboard/notifications/'
  ]
  
  for (const endpoint of dashboardTests) {
    const response = await fetch(`${BASE_URL}/${endpoint}`, { headers: authHeader })
    const data = await response.json()
    console.log(`✓ ${endpoint}`, data)
  }
  
  // 4. 测试企业模块
  console.log('\n4. 测试企业模块...')
  const enterpriseTests = [
    'enterprises/',
    'enterprises/statistics/',
    'enterprises/projects/',
    'enterprises/employees/'
  ]
  
  for (const endpoint of enterpriseTests) {
    try {
      const response = await fetch(`${BASE_URL}/${endpoint}`, { headers: authHeader })
      const data = await response.json()
      console.log(`✓ ${endpoint}`, data)
    } catch (error) {
      console.error(`✗ ${endpoint}`, error.message)
    }
  }
  
  // 5. 测试个人模块
  console.log('\n5. 测试个人模块...')
  const personalTests = [
    'persons/statistics/',
    'persons/projects/',
    'persons/tasks/'
  ]
  
  for (const endpoint of personalTests) {
    try {
      const response = await fetch(`${BASE_URL}/${endpoint}`, { headers: authHeader })
      const data = await response.json()
      console.log(`✓ ${endpoint}`, data)
    } catch (error) {
      console.error(`✗ ${endpoint}`, error.message)
    }
  }
  
  // 6. 测试信息广场
  console.log('\n6. 测试信息广场...')
  const infoPlazaTests = [
    'info-plaza/posts/',
    'info-plaza/categories/',
    'info-plaza/tags/'
  ]
  
  for (const endpoint of infoPlazaTests) {
    try {
      const response = await fetch(`${BASE_URL}/${endpoint}`, { headers: authHeader })
      const data = await response.json()
      console.log(`✓ ${endpoint}`, data)
    } catch (error) {
      console.error(`✗ ${endpoint}`, error.message)
    }
  }
  
  console.log('\n测试完成!')
}

// 运行测试
testAllAPIs()
```

---

## 检查清单

### 登录页面 (/login)
- [ ] 用户名密码登录正常
- [ ] 一键登录按钮正常（管理员、企业、个人）
- [ ] 登录成功后获得token
- [ ] Token保存到localStorage
- [ ] 登录成功后正确跳转
- [ ] 登录失败显示错误消息

### 仪表板 (/dashboard)
- [ ] 统计数据正常加载
- [ ] 最近活动列表显示
- [ ] 待办任务列表显示
- [ ] 系统通知列表显示
- [ ] 图表正常渲染

### 企业中心 (/dashboard/enterprise)
- [ ] 企业统计数据加载
- [ ] 项目列表正常显示
- [ ] 可以创建新项目
- [ ] 可以编辑项目
- [ ] 员工列表正常显示
- [ ] 可以添加员工
- [ ] 搜索和筛选功能正常

### 个人中心 (/dashboard/personal)
- [ ] 个人统计数据加载
- [ ] 我的项目列表显示
- [ ] 我的任务列表显示
- [ ] 可以完成任务
- [ ] 可以编辑任务
- [ ] 可以删除任务
- [ ] 任务筛选功能正常

### 信息广场 (/dashboard/info-plaza)
- [ ] 信息列表正常加载
- [ ] 搜索功能正常
- [ ] 类型筛选正常
- [ ] 排序功能正常
- [ ] 点赞功能正常
- [ ] 点赞数实时更新

### 系统管理 (/dashboard/system)
- [ ] 用户列表正常显示
- [ ] 用户搜索功能正常
- [ ] 可以禁用/启用用户
- [ ] 角色管理功能正常
- [ ] 系统日志显示正常

---

## 报告问题

如果发现接口问题，请记录以下信息:

1. **请求信息:**
   - URL
   - Method
   - Headers
   - Request Payload

2. **响应信息:**
   - Status Code
   - Response Data
   - Error Message

3. **环境信息:**
   - 浏览器版本
   - 前端服务地址
   - 后端服务地址
   - 登录的用户类型

4. **复现步骤:**
   - 详细的操作步骤
   - 预期结果
   - 实际结果

---

**测试愉快！**




