# ç³»ç»Ÿç®¡ç†é¡µé¢ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨è®¿é—®ç³»ç»Ÿç®¡ç†é¡µé¢ï¼ˆè§’è‰²ç®¡ç†ã€ç³»ç»Ÿæ—¥å¿—ï¼‰æ—¶ï¼Œæµè§ˆå™¨Consoleå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

```
Uncaught (in promise) TypeError: Cannot read properties of undefined (reading '$api')
    at Proxy.beforeCreate (Roles.vue:48:1)
```

## ğŸ” é—®é¢˜åŸå› 

ç³»ç»Ÿç®¡ç†ç›¸å…³é¡µé¢ï¼ˆ`Roles.vue` å’Œ `Logs.vue`ï¼‰ä½¿ç”¨äº†é”™è¯¯çš„APIè°ƒç”¨æ–¹å¼ï¼š

1. **é”™è¯¯çš„å†™æ³•:** ä½¿ç”¨ `this.$api`ï¼ˆè¯•å›¾ä»Vueå®ä¾‹ä¸Šè®¿é—®ï¼‰
2. **é”™è¯¯çš„beforeCreateé’©å­:** å°è¯•æ‰‹åŠ¨æŒ‚è½½ `$api` åˆ°å®ä¾‹

```javascript
// âŒ é”™è¯¯çš„å†™æ³•
export default {
  methods: {
    async loadData() {
      const response = await this.$api.get('/endpoint/')
    }
  },
  beforeCreate() {
    this.$api = this.$root.$options.globalProperties.$api || require('@/api').default
  }
}
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

é¡¹ç›®ä¸­åº”è¯¥ç›´æ¥å¯¼å…¥ `api` æ¨¡å—ï¼Œè€Œä¸æ˜¯é€šè¿‡Vueå®ä¾‹è®¿é—®ï¼š

```javascript
// âœ… æ­£ç¡®çš„å†™æ³•
import api from '@/api'
import { ElMessage, ElMessageBox } from 'element-plus'

export default {
  methods: {
    async loadData() {
      const response = await api.get('/endpoint/')
    }
  }
}
```

## ğŸ“ ä¿®å¤çš„æ–‡ä»¶

### 1. frontend/src/views/system/Roles.vue

**ä¸»è¦ä¿®æ”¹:**
- âœ… æ·»åŠ æ­£ç¡®çš„å¯¼å…¥è¯­å¥
- âœ… å°†æ‰€æœ‰ `this.$api` æ”¹ä¸º `api`
- âœ… å°† `this.$message` æ”¹ä¸º `ElMessage`
- âœ… å°† `this.$confirm` æ”¹ä¸º `ElMessageBox.confirm`
- âœ… å°† `this.$prompt` æ”¹ä¸º `ElMessageBox.prompt`
- âœ… å°† `this.$alert` æ”¹ä¸º `ElMessageBox.alert`
- âœ… åˆ é™¤ `beforeCreate` é’©å­
- âœ… æ·»åŠ æ•°æ®æ ¼å¼åŒ–é€»è¾‘
- âœ… æ·»åŠ  `getLevelText` æ–¹æ³•

**ä¿®æ”¹å‰:**
```javascript
export default {
  methods: {
    async loadRoles() {
      const response = await this.$api.get('/auth/roles/')
      this.$message.success('åŠ è½½æˆåŠŸ')
    }
  },
  beforeCreate() {
    this.$api = this.$root.$options.globalProperties.$api || require('@/api').default
  }
}
```

**ä¿®æ”¹å:**
```javascript
import api from '@/api'
import { ElMessage, ElMessageBox } from 'element-plus'

export default {
  methods: {
    async loadRoles() {
      const response = await api.get('/auth/roles/')
      ElMessage.success('åŠ è½½æˆåŠŸ')
    }
  }
}
```

---

### 2. frontend/src/views/system/Logs.vue

**ä¸»è¦ä¿®æ”¹:**
- âœ… æ·»åŠ æ­£ç¡®çš„å¯¼å…¥è¯­å¥
- âœ… å°†æ‰€æœ‰ `this.$api` æ”¹ä¸º `api`
- âœ… å°† `this.$message` æ”¹ä¸º `ElMessage`
- âœ… å°† `this.$confirm` æ”¹ä¸º `ElMessageBox.confirm`
- âœ… å°† `this.$alert` æ”¹ä¸º `ElMessageBox.alert`
- âœ… åˆ é™¤ `beforeCreate` é’©å­
- âœ… æ·»åŠ æ•°æ®æ ¼å¼åŒ–é€»è¾‘
- âœ… æ·»åŠ  `getLevelText` æ–¹æ³•
- âœ… ç®€åŒ– `filteredLogs` è®¡ç®—å±æ€§ï¼ˆç­›é€‰ç”±åç«¯å¤„ç†ï¼‰

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•è§’è‰²ç®¡ç†é¡µé¢

1. **è®¿é—®é¡µé¢**
   ```
   URL: http://localhost:5173/dashboard/system/roles
   ```

2. **æ£€æŸ¥æµè§ˆå™¨Console**
   - âœ… åº”è¯¥æ²¡æœ‰é”™è¯¯ä¿¡æ¯
   - âœ… ä¸åº”è¯¥æœ‰ "Cannot read properties of undefined" é”™è¯¯

3. **æ£€æŸ¥Networkè¯·æ±‚**
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - åˆ‡æ¢åˆ°Networkæ ‡ç­¾
   - åº”è¯¥çœ‹åˆ°: `GET /api/v1/auth/roles/`
   - çŠ¶æ€ç åº”è¯¥æ˜¯ 200

4. **æµ‹è¯•åŠŸèƒ½**
   - [ ] é¡µé¢æ­£å¸¸åŠ è½½
   - [ ] èƒ½çœ‹åˆ°è§’è‰²åˆ—è¡¨
   - [ ] ç‚¹å‡»"æ·»åŠ è§’è‰²"æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ­£å¸¸å¼¹å‡º
   - [ ] ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ­£å¸¸æ˜¾ç¤º
   - [ ] ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ­£å¸¸å¼¹å‡º

---

### æµ‹è¯•ç³»ç»Ÿæ—¥å¿—é¡µé¢

1. **è®¿é—®é¡µé¢**
   ```
   URL: http://localhost:5173/dashboard/system/logs
   ```

2. **æ£€æŸ¥æµè§ˆå™¨Console**
   - âœ… åº”è¯¥æ²¡æœ‰é”™è¯¯ä¿¡æ¯
   - âœ… ä¸åº”è¯¥æœ‰ "Cannot read properties of undefined" é”™è¯¯

3. **æ£€æŸ¥Networkè¯·æ±‚**
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - åˆ‡æ¢åˆ°Networkæ ‡ç­¾
   - åº”è¯¥çœ‹åˆ°: `GET /api/v1/system/logs/`
   - çŠ¶æ€ç åº”è¯¥æ˜¯ 200

4. **æµ‹è¯•åŠŸèƒ½**
   - [ ] é¡µé¢æ­£å¸¸åŠ è½½
   - [ ] èƒ½çœ‹åˆ°æ—¥å¿—åˆ—è¡¨ï¼ˆå¦‚æœæœ‰æ•°æ®ï¼‰
   - [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
   - [ ] ç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®ï¼Œæ—¥å¿—è¯¦æƒ…æ­£å¸¸æ˜¾ç¤º
   - [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| APIè°ƒç”¨æ–¹å¼ | âŒ this.$api | âœ… api |
| æ¶ˆæ¯æç¤ºæ–¹å¼ | âŒ this.$message | âœ… ElMessage |
| å¯¹è¯æ¡†æ–¹å¼ | âŒ this.$confirm | âœ… ElMessageBox |
| beforeCreateé’©å­ | âŒ å­˜åœ¨ | âœ… å·²åˆ é™¤ |
| é¡µé¢åŠ è½½ | âŒ æŠ¥é”™ | âœ… æ­£å¸¸ |
| æ•°æ®æ ¼å¼åŒ– | âŒ æ—  | âœ… æœ‰ |

---

## ğŸ¯ å…¶ä»–ç›¸å…³é¡µé¢æ£€æŸ¥

ç»è¿‡æ£€æŸ¥ï¼Œä»¥ä¸‹é¡µé¢ä½¿ç”¨äº†æ­£ç¡®çš„APIè°ƒç”¨æ–¹å¼ï¼Œæ— éœ€ä¿®å¤ï¼š

- âœ… Users.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… enterprise/Projects.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… enterprise/Employees.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… personal/Projects.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… personal/Tasks.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… info-plaza/index.vue - ä½¿ç”¨ `api` å¯¼å…¥
- âœ… resources/index.vue - ä½¿ç”¨ `api` å¯¼å…¥ï¼ˆåˆšä¿®å¤ï¼‰

---

## ğŸ’¡ æœ€ä½³å®è·µ

### åœ¨Vue 3é¡¹ç›®ä¸­è°ƒç”¨APIçš„æ­£ç¡®æ–¹å¼ï¼š

```javascript
// 1. å¯¼å…¥æ‰€éœ€æ¨¡å—
import api from '@/api'
import { ElMessage, ElMessageBox } from 'element-plus'

export default {
  name: 'MyComponent',
  
  methods: {
    // 2. ä½¿ç”¨å¯¼å…¥çš„apiå¯¹è±¡
    async fetchData() {
      try {
        const response = await api.get('/endpoint/')
        ElMessage.success('æ“ä½œæˆåŠŸ')
        return response.data
      } catch (error) {
        console.error('é”™è¯¯:', error)
        ElMessage.error('æ“ä½œå¤±è´¥')
      }
    },
    
    // 3. ä½¿ç”¨ElMessageBoxè¿›è¡Œç¡®è®¤
    async deleteItem() {
      try {
        await ElMessageBox.confirm('ç¡®å®šåˆ é™¤å—ï¼Ÿ', 'ç¡®è®¤', {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning'
        })
        
        await api.delete('/endpoint/')
        ElMessage.success('åˆ é™¤æˆåŠŸ')
      } catch (error) {
        if (error !== 'cancel') {
          ElMessage.error('åˆ é™¤å¤±è´¥')
        }
      }
    }
  }
}
```

---

## ğŸš« é¿å…çš„é”™è¯¯å†™æ³•

```javascript
// âŒ ä¸è¦è¿™æ ·å†™
export default {
  methods: {
    async loadData() {
      // é”™è¯¯1: ä½¿ç”¨ this.$api
      const response = await this.$api.get('/endpoint/')
      
      // é”™è¯¯2: ä½¿ç”¨ this.$message
      this.$message.success('æˆåŠŸ')
      
      // é”™è¯¯3: ä½¿ç”¨ this.$confirm
      await this.$confirm('ç¡®è®¤å—ï¼Ÿ', 'æç¤º')
    }
  },
  
  // é”™è¯¯4: ä½¿ç”¨ beforeCreate æŒ‚è½½ api
  beforeCreate() {
    this.$api = require('@/api').default
  }
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

ä¿®å¤å®Œæˆåï¼Œä»¥ä¸‹æ¡ä»¶åº”è¯¥å…¨éƒ¨æ»¡è¶³ï¼š

- [ ] æµè§ˆå™¨Consoleæ— é”™è¯¯ä¿¡æ¯
- [ ] è§’è‰²ç®¡ç†é¡µé¢æ­£å¸¸åŠ è½½
- [ ] ç³»ç»Ÿæ—¥å¿—é¡µé¢æ­£å¸¸åŠ è½½
- [ ] æ‰€æœ‰æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰å¯¹è¯æ¡†æ­£å¸¸å¼¹å‡º
- [ ] Networkä¸­èƒ½çœ‹åˆ°æ­£ç¡®çš„APIè¯·æ±‚
- [ ] æ‰€æœ‰APIè¯·æ±‚è¿”å›æ­£å¸¸çŠ¶æ€ç 

---

## ğŸ“… ä¿®å¤æ—¶é—´
2025-10-21

## ğŸ“Œ ç‰ˆæœ¬
v3.0

---

**ä¿®å¤å®Œæˆï¼** ç°åœ¨ç³»ç»Ÿç®¡ç†ç›¸å…³é¡µé¢åº”è¯¥å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚è¯·åˆ·æ–°é¡µé¢å¹¶æµ‹è¯•åŠŸèƒ½ã€‚ ğŸ‰



